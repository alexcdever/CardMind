# CardMind 技术栈文档

## 目录

1. [概述](#1-概述)
   1.1 [开发优先级](#11-开发优先级)
   1.2 [技术栈核心原则](#12-技术栈核心原则)
   1.3 [部署策略](#13-部署策略)
   1.4 [后端服务架构](#14-后端服务架构)
2. [前端技术栈](#2-前端技术栈)
   2.1 [核心框架](#21-核心框架)
   2.2 [UI组件库](#22-ui组件库)
   2.3 [状态管理](#23-状态管理)
   2.4 [数据存储](#24-数据存储)
   2.5 [实时同步](#25-实时同步)
   2.6 [开发工具](#26-开发工具)
   2.7 [依赖管理](#27-依赖管理)
   2.8 [PWA支持](#28-pwa支持)
   2.9 [跨平台支持](#29-跨平台支持)
3. [后端技术栈](#3-后端技术栈)
   3.1 [运行时环境](#31-运行时环境)
   3.2 [Web框架](#32-web框架)
   3.3 [实时通信](#33-实时通信)
   3.4 [网络发现](#34-网络发现)
4. [数据模型](#4-数据模型)
   4.1 [核心实体](#41-核心实体)
   4.2 [数据结构](#42-数据结构)
5. [开发环境](#5-开发环境)
   5.1 [构建工具](#51-构建工具)
   5.2 [代码质量](#52-代码质量)
   5.3 [测试工具](#53-测试工具)
   5.4 [部署工具](#54-部署工具)
6. [目录结构](#6-目录结构)
7. [技术选型考虑](#7-技术选型考虑)
8. [跨平台兼容性](#8-跨平台兼容性)

## 1. 概述

本文档介绍CardMind项目使用的核心技术栈，面向开发人员和技术决策者。CardMind采用**以Web技术栈为核心**的开发策略，支持跨平台部署和离线优先的数据同步。

### 1.1 开发优先级

| 平台类型 | 优先级 | 落地顺序 | 部署方式 |
|---------|--------|----------|----------|
| **Electron (PC)** | 最高 | 1 | 桌面应用，内置后端服务 |
| **React Native (移动端)** | 中等 | 2 | 移动应用，依赖其他平台服务 |
| **Web 平台** | 最低 | 3 | Web应用，提供托管部署 |

### 1.2 技术栈核心原则

- **Web技术栈优先**：所有功能首先基于Web技术栈实现
- **跨平台复用**：最大化复用Web技术栈代码，减少平台特定代码
- **渐进式增强**：针对不同平台特性进行渐进式增强
- **统一开发体验**：使用相同的开发工具和流程

### 1.3 部署策略

- **PC平台**：Electron打包为桌面应用，内置完整后端服务（子进程形式）
- **移动端**：React Native编译为原生应用，连接到PC或Web平台的后端服务
- **Web平台**：提供托管部署服务，支持用户直接在浏览器中使用

### 1.4 后端服务架构

- **核心设计**：基于Node.js的后端服务，支持多种部署方式
- **Electron集成**：以子进程形式内置到Electron应用中
- **Web平台部署**：容器化部署到云服务器
- **代码共享**：Electron和Web平台使用完全相同的后端代码

## 2. 前端技术栈

### 2.1 核心框架
- **React**: 用于构建用户界面的JavaScript库
- **TypeScript**: 提供类型安全的JavaScript超集

### 2.2 UI组件库
- **Ant Design**: 企业级UI组件库
- **Tailwind CSS**: 实用优先的CSS框架，用于快速构建自定义设计

### 2.3 状态管理
- **Zustand**: 轻量级状态管理解决方案

### 2.4 数据存储
- **Dexie.js**: IndexedDB的包装库，简化本地数据库操作
- **IndexedDB**: 浏览器内置的本地存储机制，用于存储业务数据

### 2.5 实时同步
- **Yjs**: CRDT(Conflict-free Replicated Data Type)库，实现无冲突数据同步
- **WebRTC**: 实现点对点实时通信
- **y-webrtc**: Yjs的WebRTC连接器
- **y-indexeddb**: Yjs的IndexedDB持久化适配器

### 2.6 开发工具
- **Vite**: 下一代前端构建工具，提供极速开发体验
- **ESLint**: 代码质量工具
- **Prettier**: 代码格式化工具
- **Jest**: 测试框架
- **Cypress**: E2E测试框架

### 2.7 依赖管理
- **pnpm**: 高性能的Node.js包管理器

### 2.8 PWA支持
- **Workbox**: 用于构建Progressive Web App的库
- **Service Worker**: 实现离线功能和资源缓存

### 2.9 跨平台支持
- **Electron**: 将Web应用打包为桌面应用（Windows/macOS/Linux）
- **React Native**: 构建原生移动应用（iOS/Android）

## 3. 后端技术栈

### 3.1 运行时环境
- **Node.js**: JavaScript运行时环境

### 3.2 Web框架
- **Express**: 轻量级Web应用框架

### 3.3 实时通信
- **WebSocket**: 实时双向通信协议，用于WebRTC信令传输

### 3.4 数据存储
- **LevelDB**: 高性能键值存储数据库，用于服务端Yjs文档持久化
- **y-leveldb**: Yjs官方提供的LevelDB持久化插件，专为Yjs文档设计

## 4. 数据模型

### 4.1 核心实体
- **Card**: 卡片实体，包含id、title、content、createdAt、updatedAt、isDeleted等字段
- **Network**: 网络实体，包含networkId、accessCode、createdAt等字段
- **Device**: 设备实体，包含deviceId、deviceName、platform、lastSeen等字段

### 4.2 数据结构
- **Yjs文档**: 使用Yjs的CRDT数据结构存储卡片数据
- **IndexedDB**: 浏览器本地存储，用于持久化卡片数据

## 5. 开发环境

### 5.1 构建工具
- **Vite**: 前端构建工具
- **TypeScript**: 类型检查和编译
- **ESBuild**: 快速JavaScript打包器

### 5.2 代码质量
- **ESLint**: JavaScript/TypeScript代码检查
- **Prettier**: 代码格式化

### 5.3 测试工具
- **Jest**: JavaScript测试框架
- **React Testing Library**: React组件测试
- **Cypress**: 端到端测试

### 5.4 部署工具
- **Docker**: 容器化部署
- **PM2**: Node.js进程管理器

## 6. 目录结构

```
src/
├── components/         # React组件（React + TypeScript + Ant Design）
├── stores/            # 状态管理（Zustand）
├── services/          # 业务服务（TypeScript）
├── types/             # 类型定义（TypeScript）
├── utils/             # 工具函数（TypeScript）
└── main.tsx           # 应用入口（React + TypeScript）

public/
├── service-worker.js  # Service Worker（PWA支持）
├── manifest.json      # PWA清单文件
└── test-network.html  # 网络测试页面

signaling-server/      # 信令服务器（Node.js + Express + WebSocket）
└── src/
    └── yjs-document-manager.js  # Yjs文档管理
```

## 7. 技术选型考虑

- 前端框架选择React是基于其生态成熟度和开发效率
- 状态管理选择Zustand而非Redux是为了简化代码结构
- 使用Yjs实现CRDT同步是为了解决多设备数据冲突问题
- WebRTC用于实现设备间直接通信，无需依赖后端服务器
- 离线优先设计确保在无网络环境下仍能正常使用

## 8. 跨平台兼容性

- Web平台需要额外的信令服务器支持WebRTC连接
- Electron和React Native平台可以内置信令服务
- 不同平台的存储机制不同，需要适配层统一接口
- 采用响应式设计确保在不同设备上都有良好的用户体验