# 全屏编辑器规格

**状态**: 活跃
**依赖**: [../../../domain/card.md](../../../domain/card.md), [note_card.md](note_card.md)
**相关测试**: `test/feature/widgets/fullscreen_editor_feature_test.dart`

---

## 概述

本规格定义移动平台的全屏编辑器，提供沉浸式编辑体验并减少干扰。

---

## 需求：沉浸式全屏编辑体验

系统应提供针对移动平台优化的全屏编辑器，减少干扰。

### 场景：打开现有卡片的编辑器

- **前置条件**: 选择了现有卡片进行编辑
- **操作**: 用户打开全屏编辑器
- **预期结果**: 系统应使用卡片的当前数据预填充标题和内容字段

### 场景：打开新卡片编辑器

- **前置条件**: 用户想要创建新卡片
- **操作**: 用户打开不含卡片的全屏编辑器
- **预期结果**: 系统应显示空的标题和内容字段，准备接受输入

---

## 需求：编辑器内标签管理

系统应在全屏编辑器内提供标签管理功能。

### 场景：编辑时添加标签

- **前置条件**: 用户正在编辑卡片
- **操作**: 用户在编辑器中添加标签
- **预期结果**: 保存卡片时应包含该标签

### 场景：编辑时移除标签

- **前置条件**: 卡片有一个或多个标签
- **操作**: 用户在编辑器中移除标签
- **预期结果**: 保存卡片时应排除该标签

---

## 需求：保存与取消操作

系统应提供明确的保存和取消操作。

### 场景：保存编辑的卡片

- **前置条件**: 用户对卡片进行了更改
- **操作**: 用户点击保存按钮
- **预期结果**: 系统应使用更新的卡片数据调用 onSave 回调
- **并且**: 关闭全屏编辑器

### 场景：取消编辑

- **前置条件**: 用户正在编辑卡片
- **操作**: 用户点击取消按钮
- **预期结果**: 系统应在不保存的情况下调用 onCancel 回调
- **并且**: 关闭全屏编辑器

---

## 需求：键盘优化

系统应优化键盘行为以实现高效的移动编辑。

### 场景：自动聚焦标题字段

- **前置条件**: 用户正在创建新卡片
- **操作**: 为新卡片打开编辑器
- **预期结果**: 系统应自动聚焦标题字段并显示键盘

### 场景：字段转换时保持键盘显示

- **前置条件**: 用户正在编辑卡片
- **操作**: 用户从标题字段移动到内容字段
- **预期结果**: 键盘应保持可见，不会消失后重新出现

---

## 测试覆盖

**测试文件**: `test/feature/widgets/fullscreen_editor_feature_test.dart`

**组件测试**:
- `it_should_prepopulate_existing_card_data()` - 预填充现有卡片
- `it_should_display_empty_fields_for_new_card()` - 显示空字段
- `it_should_include_added_tags()` - 包含添加的标签
- `it_should_exclude_removed_tags()` - 排除移除的标签
- `it_should_save_and_close_on_save()` - 保存并关闭
- `it_should_autofocus_title_for_new_card()` - 自动聚焦标题
- `it_should_maintain_keyboard_on_field_transition()` - 保持键盘

**验收标准**:
- [ ] 所有功能测试（Widget）通过
- [ ] 键盘行为流畅
- [ ] 代码审查通过
- [ ] 文档已更新
