# 移动端同步屏幕规格

## 概述

本规格定义移动端同步屏幕，用于展示同步状态、设备列表、同步历史与控制同步行为。

**移动端特定模式**:
- 下拉刷新更新设备列表与同步状态
- 浮动操作按钮触发手动同步

---

## 需求：显示全面的同步状态

系统应提供显示详细同步信息的专用屏幕。

### 场景：显示整体同步状态

- **前置条件**: 用户导航到同步屏幕
- **操作**: 同步屏幕加载
- **预期结果**: 系统应显示当前同步状态（已同步、同步中、错误）
- **并且**: 显示上次成功同步的时间戳
- **并且**: 显示已同步卡片的总数

---

## 需求：列出发现的设备

系统应显示所有发现的对等设备及其连接状态。

### 场景：显示设备列表

- **前置条件**: 同步屏幕已显示
- **操作**: 同步屏幕加载
- **预期结果**: 系统应列出所有发现的设备
- **并且**: 显示每个设备的在线/离线状态
- **并且**: 显示设备类型（手机、笔记本、平板）
- **并且**: 显示离线设备的上次可见时间戳

### 场景：刷新设备列表

- **前置条件**: 设备列表已显示
- **操作**: 用户触发刷新操作
- **预期结果**: 系统应重新扫描可用设备
- **并且**: 更新设备列表

---

## 需求：显示同步历史

系统应显示最近同步事件的时间顺序列表。

### 场景：显示同步事件日志

- **前置条件**: 同步屏幕已显示
- **操作**: 用户查看同步历史部分
- **预期结果**: 系统应显示带有时间戳的最近同步事件
- **并且**: 指示每个事件的成功或失败
- **并且**: 显示每次同步涉及的设备

### 场景：过滤同步历史

- **前置条件**: 同步历史已显示
- **操作**: 用户应用历史过滤器
- **预期结果**: 系统应按设备、状态或时间范围过滤事件

---

## 需求：提供手动同步控制

系统应提供手动同步操作。

### 场景：触发手动同步

- **前置条件**: 同步屏幕已显示
- **操作**: 用户点击“立即同步”按钮
- **预期结果**: 系统应立即尝试与可用设备同步
- **并且**: 显示同步进度指示器
- **并且**: 完成时更新状态

### 场景：强制完全同步

- **前置条件**: 同步屏幕已显示
- **操作**: 用户触发完全同步操作
- **预期结果**: 系统应执行所有数据的完全重新同步
- **并且**: 显示详细的进度信息

---

## 需求：显示同步统计信息

系统应显示同步指标和统计信息。

### 场景：显示数据量

- **前置条件**: 同步屏幕已显示
- **操作**: 用户查看同步统计信息
- **预期结果**: 系统应显示已同步的总数据量
- **并且**: 显示每个设备同步的数据

### 场景：显示同步成功率

- **前置条件**: 同步屏幕已显示
- **操作**: 用户查看同步统计信息
- **预期结果**: 系统应显示成功同步的百分比
- **并且**: 显示失败同步的次数及原因

---

## 需求：配置同步设置

系统应允许用户配置同步首选项。

### 场景：切换自动同步

- **前置条件**: 同步屏幕已显示
- **操作**: 用户切换自动同步设置
- **预期结果**: 系统应启用或禁用自动同步

### 场景：设置同步频率

- **前置条件**: 自动同步已启用
- **操作**: 用户配置同步频率
- **预期结果**: 系统应允许用户设置同步频率（立即、每 N 分钟等）

---

## 需求：显示同步冲突

系统应显示并帮助解决同步冲突。

### 场景：列出冲突

- **前置条件**: 存在同步冲突
- **操作**: 同步屏幕加载
- **预期结果**: 系统应显示冲突部分
- **并且**: 列出所有未解决的冲突

### 场景：查看冲突详情

- **前置条件**: 冲突已列出
- **操作**: 用户点击冲突
- **预期结果**: 系统应显示冲突数据的两个版本
- **并且**: 允许用户选择保留哪个版本

---

## 测试覆盖

**测试文件**: `test/feature/screens/sync_screen_feature_test.dart`

**屏幕测试**:
- `it_should_show_overall_sync_status()` - 显示整体同步状态
- `it_should_list_discovered_devices()` - 显示设备列表
- `it_should_show_device_status()` - 显示设备状态
- `it_should_refresh_device_list()` - 刷新设备列表
- `it_should_display_sync_event_log()` - 显示同步事件日志
- `it_should_filter_sync_history()` - 过滤同步历史
- `it_should_trigger_manual_sync()` - 触发手动同步
- `it_should_force_full_sync()` - 执行完全同步
- `it_should_show_sync_statistics()` - 显示同步统计信息
- `it_should_toggle_auto_sync()` - 切换自动同步
- `it_should_set_sync_frequency()` - 设置同步频率
- `it_should_list_conflicts()` - 列出冲突
- `it_should_show_conflict_details()` - 显示冲突详情

**验收标准**:
- [ ] 所有屏幕测试通过
- [ ] 设备发现正常工作
- [ ] 手动同步控制可靠
- [ ] 冲突解决清晰
- [ ] 代码审查通过
- [ ] 文档已更新
