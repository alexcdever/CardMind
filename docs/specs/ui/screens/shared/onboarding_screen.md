# 应用引导屏幕规格（通用）

**状态**: 生效中
**依赖**: [../../../domain/pool.md](../../../domain/pool.md), [../../../architecture/storage/device_config.md](../../../architecture/storage/device_config.md)
**相关测试**: `test/screens/onboarding_screen_test.dart`

---

## 概述

本规格定义首次启动引导流程，帮助用户完成应用初始化。引导流程在移动端与桌面端共享，并具备平台特定的 UI 适配。

**平台差异**:
- 移动端使用全屏流程与底部导航
- 桌面端使用居中对话框并支持键盘导航

---

## 需求：检测首次启动

系统应检测是否为用户首次启动应用程序。

### 场景：首次启动显示欢迎屏幕

- **前置条件**: 用户首次打开应用
- **操作**: 应用启动
- **预期结果**: 系统应检查设备配置是否存在
- **并且**: 如果配置不存在则显示欢迎屏幕

### 场景：后续启动显示主屏幕

- **前置条件**: 用户已完成引导
- **操作**: 应用启动
- **预期结果**: 系统应找到现有的设备配置
- **并且**: 直接导航到主屏幕

---

## 需求：显示欢迎屏幕

系统应显示介绍应用程序的欢迎屏幕。

### 场景：显示应用介绍

- **前置条件**: 欢迎屏幕已显示
- **操作**: 用户查看屏幕
- **预期结果**: 系统应显示应用名称“CardMind”
- **并且**: 显示应用徽标或插图
- **并且**: 显示应用目的的简要描述

### 场景：提供开始使用操作

- **前置条件**: 欢迎屏幕已显示
- **操作**: 用户查看屏幕
- **预期结果**: 系统应显示“开始使用”按钮
- **并且**: 按钮应放置在显眼位置
- **并且**: 按钮应启用

---

## 需求：引导池创建

系统应引导用户创建他们的第一个池。

### 场景：显示池创建选项

- **前置条件**: 用户点击“开始使用”按钮
- **操作**: 按钮被点击
- **预期结果**: 系统应显示池创建屏幕
- **并且**: 解释什么是池
- **并且**: 显示“创建新池”选项

### 场景：创建新池

- **前置条件**: 用户选择“创建新池”
- **操作**: 选项被选择
- **预期结果**: 系统应显示池创建表单
- **并且**: 提供池名称输入框
- **并且**: 根据设备名称建议默认名称

### 场景：验证池名称

- **前置条件**: 用户输入池名称
- **操作**: 名称被输入
- **预期结果**: 系统应验证名称
- **并且**: 拒绝空名称
- **并且**: 如果无效则显示验证错误

### 场景：完成池创建

- **前置条件**: 用户输入有效的池名称并确认
- **操作**: 创建被确认
- **预期结果**: 系统应创建池
- **并且**: 将设备加入池
- **并且**: 保存设备配置
- **并且**: 初始化卡片存储
- **并且**: 导航到主屏幕
- **并且**: 显示成功消息“池已创建”

---

## 需求：处理引导错误

系统应优雅地处理引导期间的错误。

### 场景：池创建失败时显示错误

- **前置条件**: 池创建失败
- **操作**: 错误发生
- **预期结果**: 系统应显示错误消息
- **并且**: 允许用户重试
- **并且**: 保持用户在创建屏幕上

---

## 需求：支持平台特定的 UI

系统应使引导 UI 适应平台约定。

### 场景：移动端引导使用全屏流程

- **前置条件**: 用户在移动设备上
- **操作**: 引导开始
- **预期结果**: 系统应使用全屏页面
- **并且**: 使用底部按钮进行导航
- **并且**: 支持步骤之间的滑动手势

### 场景：桌面端引导使用居中对话框

- **前置条件**: 用户在桌面设备上
- **操作**: 引导开始
- **预期结果**: 系统应使用居中对话框或窗口
- **并且**: 使用标准对话框按钮
- **并且**: 支持键盘导航

---

## 测试覆盖

**测试文件**: `test/screens/onboarding_screen_test.dart`

**组件测试**:
- `it_should_detect_first_launch()` - 检测首次启动
- `it_should_show_welcome_screen()` - 显示欢迎屏幕
- `it_should_navigate_to_home_on_subsequent_launch()` - 后续启动导航到主屏幕
- `it_should_show_app_introduction()` - 显示应用介绍
- `it_should_provide_get_started_button()` - 提供开始使用按钮
- `it_should_show_pool_creation_options()` - 显示池创建选项
- `it_should_create_new_pool()` - 创建新池
- `it_should_validate_pool_name()` - 验证池名称
- `it_should_complete_pool_creation()` - 完成池创建
- `it_should_handle_creation_error()` - 处理创建错误
- `it_should_adapt_to_mobile()` - 适配移动端 UI
- `it_should_adapt_to_desktop()` - 适配桌面端 UI

**验收标准**:
- [ ] 所有组件测试通过
- [ ] 首次启动检测正常工作
- [ ] 池创建流程直观
- [ ] 错误处理优雅
- [ ] 平台特定 UI 正确适配
- [ ] 代码审查通过
- [ ] 文档已更新
