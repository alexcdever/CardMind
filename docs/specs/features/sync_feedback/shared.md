# 同步反馈交互规格（共享）


---


本规格定义 CardMind 的同步反馈交互需求。


---


### 需求：系统在应用栏中显示同步状态指示器


系统应在应用栏中显示同步状态指示器，显示当前同步状态。

#### 场景：指示器在应用栏中可见

- **操作**：用户在主屏幕上
- **预期结果**：同步状态指示器在应用栏右侧可见

#### 场景：指示器实时更新

- **操作**：同步状态改变
- **预期结果**：指示器在 500ms 内更新

#### 场景：指示器订阅状态流

- **操作**：主屏幕加载
- **预期结果**：系统订阅 `SyncApi.statusStream`

#### 场景：销毁时取消订阅

- **操作**：主屏幕销毁
- **预期结果**：系统取消订阅状态流


---


### 需求：系统定义同步状态机


系统应实现四状态同步状态机。

#### 场景：初始状态为断开连接

- **操作**：应用启动且无对等设备
- **预期结果**：同步状态为 `disconnected`

#### 场景：从断开连接转换到同步中

- **操作**：系统发现对等设备并开始同步
- **预期结果**：同步状态转换为 `syncing`

#### 场景：从同步中转换到已同步

- **操作**：同步成功完成
- **预期结果**：同步状态转换为 `synced`

#### 场景：从同步中转换到失败

- **操作**：同步因错误失败
- **预期结果**：同步状态转换为 `failed`

#### 场景：从已同步转换到同步中

- **操作**：检测到新更改
- **预期结果**：同步状态转换为 `syncing`

#### 场景：从失败转换到同步中

- **操作**：用户重试同步
- **预期结果**：同步状态转换为 `syncing`


---


### 需求：系统显示断开连接状态


系统应在无可用对等设备时显示断开指示器。

#### 场景：断开连接显示 cloud_off 图标

- **操作**：同步状态为 `disconnected`
- **预期结果**：指示器显示 `Icons.cloud_off`

#### 场景：断开连接图标为灰色

- **操作**：同步状态为 `disconnected`
- **预期结果**：图标颜色为灰色（#757575）

#### 场景：断开连接显示文本

- **操作**：同步状态为 `disconnected`
- **预期结果**：指示器显示文本"未同步"

#### 场景：断开连接无动画

- **操作**：同步状态为 `disconnected`
- **预期结果**：图标静止（无动画）


---


### 需求：系统显示同步中状态


系统应在同步进行中时显示同步中指示器。

#### 场景：同步中显示同步图标

- **操作**：同步状态为 `syncing`
- **预期结果**：指示器显示 `Icons.sync`

#### 场景：同步中图标为主色

- **操作**：同步状态为 `syncing`
- **预期结果**：图标颜色为主色（#00897B）

#### 场景：同步中显示文本

- **操作**：同步状态为 `syncing`
- **预期结果**：指示器显示文本"同步中..."

#### 场景：同步中图标旋转

- **操作**：同步状态为 `syncing`
- **预期结果**：图标持续旋转（每 2 秒 360°）

#### 场景：同步中显示对等设备数量

- **操作**：同步状态为 `syncing` 且有 N 台对等设备
- **预期结果**：指示器显示"同步中（N 台设备）"


---


### 需求：系统显示已同步状态


系统应在同步完成时显示已同步指示器。

#### 场景：已同步显示 cloud_done 图标

- **操作**：同步状态为 `synced`
- **预期结果**：指示器显示 `Icons.cloud_done`

#### 场景：已同步图标为绿色

- **操作**：同步状态为 `synced`
- **预期结果**：图标颜色为绿色（#43A047）

#### 场景：已同步显示文本

- **操作**：同步状态为 `synced`
- **预期结果**：指示器显示文本"已同步"

#### 场景：已同步无动画

- **操作**：同步状态为 `synced`
- **预期结果**：图标静止（无动画）

#### 场景：已同步显示上次同步时间

- **操作**：同步状态为 `synced`
- **预期结果**：指示器显示"已同步（刚刚）"或相对时间


---


### 需求：系统显示失败状态


系统应在同步失败时显示失败指示器。

#### 场景：失败显示带警告的 cloud_off 图标

- **操作**：同步状态为 `failed`
- **预期结果**：指示器显示带警告徽章的 `Icons.cloud_off`

#### 场景：失败图标为橙色

- **操作**：同步状态为 `failed`
- **预期结果**：图标颜色为橙色（#FB8C00）

#### 场景：失败显示文本

- **操作**：同步状态为 `failed`
- **预期结果**：指示器显示文本"同步失败"

#### 场景：失败无动画

- **操作**：同步状态为 `failed`
- **预期结果**：图标静止（无动画）


---


### 需求：系统处理指示器点击


系统应处理同步状态指示器的点击。

#### 场景：点击打开同步详情

- **操作**：用户点击同步状态指示器
- **预期结果**：系统应导航到同步详情屏幕

#### 场景：点击失败状态显示重试

- **操作**：同步状态为 `failed` 且用户点击指示器
- **预期结果**：系统应显示重试选项


---


**最后更新**: 2026-01-23
**作者**: CardMind Team
