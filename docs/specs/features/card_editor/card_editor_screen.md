# 卡片编辑器屏幕规格

本规格定义了卡片编辑器屏幕，提供针对专注内容创作优化的全屏卡片编辑体验。

---

## 需求：全屏编辑体验

系统应提供针对专注内容创作优化的全屏卡片编辑体验。

### 场景：加载现有卡片

- **操作**：编辑器屏幕打开现有卡片
- **预期结果**：系统应预填充标题和内容字段
- **并且**：加载现有标签

### 场景：创建新卡片

- **操作**：编辑器屏幕打开以创建新卡片
- **预期结果**：系统应显示空的标题和内容字段
- **并且**：自动聚焦标题字段

---

## 需求：自动保存

系统应自动保存草稿内容以防止数据丢失。

### 场景：自动保存草稿

- **操作**：用户修改标题或内容
- **预期结果**：系统应在 2 秒无活动后触发自动保存

### 场景：恢复草稿

- **操作**：用户返回到未保存的草稿
- **预期结果**：系统应恢复草稿内容

---

## 需求：富文本格式化

系统应支持基本的富文本格式化。

### 场景：应用文本格式

- **操作**：用户应用格式（粗体、斜体等）
- **预期结果**：系统应将格式应用于选定的文本
- **并且**：在保存的内容中保持格式

---

## 需求：保存和丢弃选项

系统应提供明确的保存和丢弃选项。

### 场景：保存编辑

- **操作**：用户点击保存按钮
- **预期结果**：系统应将卡片持久化到后端
- **并且**：导航回上一个屏幕
- **并且**：显示成功确认

### 场景：取消编辑

- **操作**：用户在有未保存更改时点击取消/返回按钮
- **预期结果**：系统应显示确认对话框
- **并且**：如果确认则丢弃更改
- **并且**：如果取消则继续编辑

---

## 需求：标签管理

系统应在编辑器内提供标签管理。

### 场景：添加标签

- **操作**：用户添加标签
- **预期结果**：保存卡片时应包含该标签

### 场景：移除标签

- **操作**：用户移除标签
- **预期结果**：保存卡片时应排除该标签

---

## 需求：内容统计

系统应可选地显示字符或单词计数。

### 场景：显示字符计数

- **操作**：用户正在编辑内容
- **预期结果**：系统可以在状态区域显示字符计数或单词计数

---

## 测试覆盖

**测试文件**: `flutter/test/ui/card_editor_screen_test.dart`

**单元测试**:
- `it_should_prepopulate_existing_card()` - 预填充现有卡片
- `it_should_load_existing_tags()` - 加载现有标签
- `it_should_display_empty_fields_for_new_card()` - 新卡片显示空字段
- `it_should_autofocus_title_field()` - 自动聚焦标题
- `it_should_autosave_after_inactivity()` - 2秒后自动保存
- `it_should_restore_draft()` - 恢复草稿
- `it_should_apply_text_formatting()` - 应用格式化
- `it_should_maintain_formatting_in_saved_content()` - 保持格式化
- `it_should_save_and_navigate_back()` - 保存并返回
- `it_should_show_confirmation_on_discard()` - 丢弃时显示确认
- `it_should_add_tags()` - 添加标签
- `it_should_remove_tags()` - 移除标签
- `it_should_display_character_count()` - 显示计数（可选）

**验收标准**:
- [ ] 所有组件测试通过
- [ ] 自动保存可靠工作
- [ ] 富文本格式化正常工作
- [ ] 确认对话框防止数据丢失
- [ ] 代码审查通过
- [ ] 文档已更新

---

## 相关文档

**相关规格**:
- [fullscreen_editor.md](fullscreen_editor.md) - 全屏编辑器
- [note_card.md](note_card.md) - 笔记卡片组件
- [card_store.md](../../architecture/storage/card_store.md) - 卡片存储

---

**最后更新**: 2026-01-23
**作者**: CardMind Team
