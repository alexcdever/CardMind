# UI 设计文档勘误

**创建时间**: 2026-01-08
**最后更新**: 2026-01-13
**状态**: 已修正

---

## 概述

本文档记录 UI 设计文档（ui_layouts.md、ui_flows.md、feedback_design.md、information_arch.md）中与架构设计不一致的地方，需要修正。

**重要更新**: 2026-01-13 - 架构已从多数据池模型重构为单数据池（笔记空间）模型，所有相关文档已更新。

---

## 关键架构事实（来自架构文档）

### 1. 卡片与数据池的关系
- **单数据池模型**: 每个用户只有一个笔记空间（数据池）
- **自动绑定**: 卡片创建时自动添加到用户的笔记空间
- **来源**: `card_pool_ownership_refactoring.md`
- **实现状态**: ✅ 架构重构完成，UI 设计已匹配

### 2. 数据池功能已完成
- **Phase 5-6 已完成**: 数据池后端、P2P 同步全部实现 ✅
- **来源**: `TODO.md` Phase 5-6 完成报告
- **包含**:
  - PoolStore（9 个测试）
  - DeviceConfig（17 个测试）
  - 密码管理（bcrypt + Keyring，21 个测试）
  - 卡片-数据池绑定（5 个 API）
  - P2P 同步服务（8 个集成测试）

### 3. 设备昵称的复杂性
- **mDNS 广播昵称**: 使用默认昵称（设备型号-UUID前5位），如 `iPhone-018c8`
- **笔记空间昵称**: 用户可自定义笔记空间名称
- **来源**: `data_contract.md` 第 2.2 节、第 4.1 节
- **实现状态**: ✅ 后端已完成，UI 设计已简化

### 4. bcrypt 验证性能
- **单次验证耗时**: ~100ms（工作因子 12）
- **来源**: `tech_constraints.md` 第 5.4 节
- **UI 影响**: 密码验证反馈需要设置合理的加载状态，避免闪烁

---

## 已修正的问题

### 问题 1: 卡片详情页显示单个数据池 ✅ 已修正
**位置**: ui_layouts.md 第 323 行
**原问题**: 卡片可以属于多个数据池（多对多关系）
**修正**: 架构已改为单数据池模型，卡片自动属于用户的笔记空间
**状态**: ✅ 已修正

### 问题 2: 卡片编辑页数据池选择是单选 ✅ 已修正
**位置**: ui_layouts.md 第 407 行
**原问题**: 卡片可以绑定多个数据池，应该多选
**修正**: 架构已改为单数据池模型，移除了数据池绑定管理功能
**状态**: ✅ 已修正

### 问题 3: 同步状态页设备昵称未区分 ✅ 已修正
**位置**: ui_layouts.md 第 438-498 行
**原问题**: 应该区分 mDNS 昵称和数据池昵称
**修正**: 简化为单一笔记空间模型，设备昵称显示逻辑已简化
**状态**: ✅ 已修正

### 问题 4: 卡片编辑流程中数据池绑定逻辑不准确 ✅ 已修正
**位置**: ui_flows.md 第 414 行
**原问题**: 应该是管理多个数据池的绑定关系
**修正**: 移除了数据池绑定管理流程（4.4 节）
**状态**: ✅ 已修正

### 问题 5: 密码验证反馈未说明 bcrypt 耗时 ✅ 已修正
**位置**: feedback_design.md 第 223-275 行
**原问题**: 未说明 bcrypt 验证 ~100ms 的预期耗时
**修正**: 已补充验证时长设计说明
**状态**: ✅ 已修正

### 问题 6: 卡片与数据池关系描述不清晰 ✅ 已修正
**位置**: information_arch.md 第 315-344 行
**原问题**: 应该明确说明是多对多关系
**修正**: 已更新为单数据池模型，卡片自动属于笔记空间
**状态**: ✅ 已修正

### 问题 7: 跨数据池操作描述不准确 ✅ 已修正
**位置**: information_arch.md 第 347-363 行
**原问题**: 不是"移动"（排他性），而是"添加/移除绑定"
**修正**: 移除了跨数据池操作，简化为单笔记空间
**状态**: ✅ 已修正

---

## 架构重构总结

### 从多数据池到单数据池的主要变化

1. **卡片-数据池关系**:
   - 原模型: 多对多关系，一个卡片可以绑定多个数据池
   - 新模型: 单数据池，卡片自动属于用户的笔记空间

2. **数据模型变化**:
   - Card 模型移除了 `pool_ids` 字段
   - Pool 模型新增了 `card_ids` 字段（持有卡片列表）
   - DeviceConfig 简化为只允许加入一个数据池

3. **UI 功能简化**:
   - 移除了数据池切换功能
   - 移除了卡片-数据池绑定管理流程
   - 移除了常驻池概念
   - 同步状态指示从数据池芯片移到 AppBar

4. **用户体验优化**:
   - 新用户自动创建笔记空间，无需手动创建
   - 卡片创建时自动添加到笔记空间，无需选择
   - 笔记空间对用户透明，大部分操作无需关注

---

## 修正完成情况

### ✅ 已完成修正的文档

1. **ui_layouts.md** - 移除多数据池功能引用，简化为单笔记空间模型
2. **ui_flows.md** - 移除数据池绑定管理流程，简化卡片创建和管理流程
3. **feedback_design.md** - 简化单数据池的同步状态反馈，更新密码相关术语
4. **information_arch.md** - 移除数据池切换概念，更新为笔记空间隔离策略

### 🔄 待检查的文档

1. **ui_design_system.md** - 检查是否有数据池相关内容需要更新

---

**状态**: 主要修正已完成，架构重构后的文档一致性已恢复。
