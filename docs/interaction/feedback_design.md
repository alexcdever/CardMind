# 用户反馈设计

**最后更新**: 2026-01-08

---

## 概述

本文档定义 CardMind 的用户反馈机制，确保用户清楚了解系统状态和操作结果。所有反馈设计遵循**即时、清晰、不打扰**的原则。

**反馈类型**:
1. **状态反馈**: 系统当前在做什么（加载、同步）
2. **结果反馈**: 操作成功还是失败（Toast、Dialog）
3. **进度反馈**: 长时间操作的进度（进度条）
4. **微交互**: 按钮点击、开关切换的即时反馈
5. **空状态**: 无数据时的引导和说明

**特别关注**: 笔记空间和 P2P 同步相关的反馈（核心功能）

---

## 1. 加载状态反馈

### 1.1 应用启动加载

**场景**: 应用启动时加载数据

```
┌─────────────────────────────────────────┐
│                                         │
│                                         │
│              ┌───────┐                  │
│              │ Logo  │                  │ ← 应用 Logo
│              └───────┘                  │
│                                         │
│               CardMind                  │ ← 应用名称
│                                         │
│          [━━━━━━━━░░░░░░░░]            │ ← 进度条
│             正在加载卡片...             │ ← 加载文案
│                                         │
└─────────────────────────────────────────┘
```

**加载文案**:
- "正在加载卡片..." (0-50%)
- "准备就绪..." (50-100%)

**时长**:
- 目标: < 1 秒（1000 张卡片）
- 超过 2 秒显示进度条
- 超过 5 秒显示"数据较多，请稍候"

**失败处理**:
```
┌─────────────────────────────────────────┐
│              ⚠️                         │
│                                         │
│          无法加载数据                   │ ← H5, Error-Main
│                                         │
│      可能是数据库文件损坏              │ ← Body2, Neutral-600
│                                         │
│          [重试]  [恢复备份]             │ ← 操作按钮
│                                         │
└─────────────────────────────────────────┘
```

### 1.2 页面加载（骨架屏）

**场景**: 首页卡片加载

```
┌─────────────────────────────────────────┐
│ [AppBar - 正常显示]                     │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │ ░░░░░░░░░░░░░░░░░░░░                │ │ ← 标题骨架
│ │ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │ │ ← 内容骨架
│ │ ░░░░░░░░░░░░                        │ │ ← 标签骨架
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ ░░░░░░░░░░░░░░░░░░░░                │ │
│ │ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │ │
│ │ ░░░░░░░░░░░░                        │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

**骨架样式**:
- 背景: Neutral-200 (Light) / Neutral-700 (Dark)
- 动画: 从左到右的微光扫过（1.5秒循环）
- 圆角: 与实际内容一致（4px 文本，12px 卡片）

**使用场景**:
- 首页加载卡片列表
- 搜索结果加载

---

## 2. 同步状态反馈（重点）

### 2.1 实时同步状态指示器

**位置**: AppBar 右上角

```
🔄  ← 同步中（旋转动画）
     ← 已同步（无图标）
⚠️  ← 同步失败（橙色感叹号）
```

**状态定义**:

| 状态 | 图标 | 颜色 | 动画 | 说明 |
|------|------|------|------|------|
| 同步中 | 🔄 | Primary-500 | 顺时针旋转（2秒/圈） | 正在传输数据 |
| 已同步 | 无 | - | - | 所有设备数据一致 |
| 未同步 | ⚠️ | Warning-Main | 无 | 有本地变更未同步 |
| 同步失败 | ⚠️ | Error-Main | 无 | 网络错误或验证失败 |
| 离线 | - | Neutral-500 | - | 未启用同步 |

**交互**:
- 点击同步状态图标 → 打开同步详情对话框

### 2.2 同步详情对话框

点击同步状态图标后弹出：

```
┌─────────────────────────────────────────┐
│ 同步状态                           ✕    │
├─────────────────────────────────────────┤
│                                         │
│ 状态: 同步中 🔄                         │
│                                         │
│ 进度: 正在与 iPhone 13 同步             │
│ [━━━━━━━━░░░░░░░░░░░░] 45%             │
│                                         │
│ 已同步设备:                             │
│ • MacBook Pro - 2分钟前                │
│                                         │
│ 最后同步: 2026-01-08 15:20              │
│                                         │
│            [查看详情]                   │
│                                         │
└─────────────────────────────────────────┘
```

### 2.3 同步进度条

**场景**: 首次配对设备时的大量数据同步

```
┌─────────────────────────────────────────┐
│ 正在同步...                             │
├─────────────────────────────────────────┤
│                                         │
│ 正在同步 127 张卡片...                  │
│                                         │
│ [━━━━━━━━━━━━░░░░░░░░] 65%             │
│                                         │
│ 已同步: 83 / 127                        │
│ 预计剩余时间: 15 秒                     │
│                                         │
│              [取消]                     │
│                                         │
└─────────────────────────────────────────┘
```

**进度条样式**:
- 高度: 8px
- 圆角: 4px
- 背景: Neutral-200 (Light) / Neutral-700 (Dark)
- 进度: Primary-500
- 动画: 流动动画（从左到右微光扫过）

### 2.4 同步成功反馈

**Toast 提示**:
```
┌────────────────────────────────┐
│ ✓ 已同步来自 iPhone 13 的更新 │ ← Toast
└────────────────────────────────┘
  • 位置: 底部，距离底部 80px（避开 FAB）
  • 持续: 2 秒
  • 颜色: Success-Main
```

**卡片更新动画**:
- 新增卡片: 从上方滑入 + 2秒高亮（Primary-100 背景）
- 更新卡片: 闪烁一次（Primary-100 背景，持续 300ms）

### 2.5 同步失败反馈

**Toast 提示**:
```
┌────────────────────────────────┐
│ ⚠️ 同步失败: 网络连接已断开    │ ← Toast
│              [重试]             │   可交互
└────────────────────────────────┘
  • 位置: 底部
  • 持续: 5 秒（或手动关闭）
  • 颜色: Error-Main
```

**错误类型与提示**:

| 错误 | 提示文案 | 操作按钮 |
|------|----------|----------|
| 网络断开 | "同步失败: 网络连接已断开" | [重试] |
| 密码错误 | "同步失败: 密码验证失败" | [检查密码] |
| 设备离线 | "目标设备已离线" | [知道了] |
| 超时 | "同步超时，请检查网络" | [重试] |
| 未知错误 | "同步失败，请稍后重试" | [重试] [查看日志] |

---

## 3. 密码验证反馈（重点）

### 3.1 密码输入框状态

**正常状态**:
```
┌─────────────────────────────────────────┐
│ 笔记空间密码 *                          │
│ ┌─────────────────────────────────────┐ │
│ │ ••••••••                  👁         │ │ ← 眼睛图标切换显示
│ └─────────────────────────────────────┘ │
│ 最少 8 个字符                           │ ← 帮助文本
└─────────────────────────────────────────┘
```

**验证中**:
```
┌─────────────────────────────────────────┐
│ 笔记空间密码 *                          │
│ ┌─────────────────────────────────────┐ │
│ │ ••••••••                  🔄         │ │ ← 加载图标
│ └─────────────────────────────────────┘ │
│ 正在验证密码...                         │ ← Primary-500
└─────────────────────────────────────────┘
```

**验证失败**:
```
┌─────────────────────────────────────────┐
│ 笔记空间密码 *                          │
│ ┌─────────────────────────────────────┐ │
│ │ ••••••••                  👁         │ │
│ └─────────────────────────────────────┘ │ ← 边框变红（Error-Main）
│ ⚠️ 密码错误，剩余尝试次数: 2 次        │ ← Error-Main
└─────────────────────────────────────────┘
```

**验证成功**:
```
┌─────────────────────────────────────────┐
│ 笔记空间密码 *                          │
│ ┌─────────────────────────────────────┐ │
│ │ ••••••••                  ✓          │ │ ← 绿色对勾
│ └─────────────────────────────────────┘ │ ← 边框变绿（Success-Main）
│ ✓ 密码正确                              │ ← Success-Main
└─────────────────────────────────────────┘
```

**验证时长设计说明**:

CardMind 使用 **bcrypt 算法**（工作因子 12）进行密码哈希验证。

**关键性能指标**:
- **单次验证耗时**: ~100ms
- **来源**: `tech_constraints.md` 第 5.4 节

**UI 设计影响**:
1. **最小加载时长**: 验证中状态至少显示 100ms，避免一闪而过
2. **过渡动画**: 使用 200ms 的淡入淡出动画，让加载状态更自然
3. **不显示进度条**: 100ms 不需要进度条，使用旋转图标即可
4. **连续验证**: 如果用户快速切换输入框，使用 debounce 300ms 避免频繁验证

**实现建议**:
```dart
// 验证流程
onPasswordSubmit() async {
  setState(() { isVerifying = true });

  // bcrypt 验证（~100ms）
  final result = await verifyPoolPassword(poolId, password);

  // 最小显示时长 200ms，避免闪烁
  await Future.delayed(Duration(milliseconds: 200));

  setState(() {
    isVerifying = false;
    isValid = result;
  });
}
```

### 3.2 密码强度指示器

**场景**: 创建笔记空间时设置密码

```
┌─────────────────────────────────────────┐
│ 同步密码 *                              │
│ ┌─────────────────────────────────────┐ │
│ │ MyPassword123                👁     │ │
│ └─────────────────────────────────────┘ │
│ [━━━━━━░░░░░░░░░░░░░░] 中等           │ ← 强度条
│ 建议包含大小写字母、数字和符号          │
└─────────────────────────────────────────┘
```

**强度等级**:

| 强度 | 颜色 | 条件 |
|------|------|------|
| 弱 | Error-Main | < 8 字符 或 纯数字/纯字母 |
| 中等 | Warning-Main | 8-12 字符 + 字母数字组合 |
| 强 | Success-Main | > 12 字符 + 大小写 + 数字 + 符号 |

### 3.3 密码锁定提示

**超过 3 次失败**:

```
┌─────────────────────────────────────────┐
│ 🔒 密码已锁定                           │
├─────────────────────────────────────────┤
│                                         │
│   密码输入错误次数过多，已被锁定        │
│                                         │
│   请在 5 分钟后重试                     │
│                                         │
│   剩余时间: 04:32                       │ ← 倒计时
│                                         │
│              [忘记密码]                 │
│                                         │
└─────────────────────────────────────────┘
```

---

## 4. 操作结果反馈

### 4.1 Toast 提示

**场景**: 快速、非阻塞的成功/失败提示

**成功 Toast**:
```
┌────────────────────────────────┐
│ ✓ 卡片已创建                   │
└────────────────────────────────┘
  • 背景: Success-Main
  • 文字: White
  • 位置: 底部，距离底部 80px
  • 持续: 2 秒
  • 动画: 从底部滑入，淡出消失
```

**错误 Toast**:
```
┌────────────────────────────────┐
│ ⚠️ 保存失败，请重试             │
│              [重试]             │
└────────────────────────────────┘
  • 背景: Error-Main
  • 文字: White
  • 持续: 3 秒（或手动关闭）
  • 可交互: 可点击 [重试]
```

**Toast 使用场景**:

| 操作 | 成功提示 | 失败提示 |
|------|----------|----------|
| 创建卡片 | "✓ 卡片已创建" | "⚠️ 创建失败，请重试" |
| 编辑卡片 | "✓ 保存成功" | "⚠️ 保存失败，请重试" |
| 删除卡片 | "✓ 卡片已删除 [撤销]" | "⚠️ 删除失败，请重试" |
| 设备配对 | "✓ 设备配对成功" | "⚠️ 配对失败: [原因]" |
| 同步完成 | "✓ 已同步 N 张卡片" | "⚠️ 同步失败: [原因]" |

### 4.2 Snackbar（可撤销操作）

**场景**: 删除操作，提供撤销机会

```
┌──────────────────────────────────────────┐
│ ✓ 卡片已删除              [撤销]         │
└──────────────────────────────────────────┘
  • 背景: Neutral-800 (Light) / Neutral-200 (Dark)
  • 文字: White / Neutral-900
  • 位置: 底部，距离底部 80px
  • 持续: 3 秒
  • 操作: [撤销] 按钮（3秒内可点击）
```

**撤销流程**:
1. 用户点击 [撤销] → 恢复卡片 → Toast "已撤销删除"
2. 3秒后自动消失 → 删除生效

### 4.3 对话框确认

**场景**: 不可逆或重要操作的确认

**删除确认**:
```
┌─────────────────────────────────────────┐
│ 确认删除                           ✕    │
├─────────────────────────────────────────┤
│                                         │
│   确认删除这张卡片？                    │ ← H5
│                                         │
│   删除后可在 30 天内恢复               │ ← Body2, Neutral-600
│                                         │
│          [取消]        [删除]           │
│                                         │
└─────────────────────────────────────────┘
```

**危险操作确认**:
```
┌─────────────────────────────────────────┐
│ ⚠️ 警告                            ✕    │
├─────────────────────────────────────────┤
│                                         │
│   此笔记空间包含 127 张卡片            │
│                                         │
│   删除后可在 30 天内恢复，但已同步      │
│   到其他设备的卡片不会被删除。          │
│                                         │
│   确认要删除笔记空间吗？                │
│                                         │
│          [取消]        [确认删除]       │ ← [确认删除] 用 Error-Main
│                                         │
└─────────────────────────────────────────┘
```

---

## 5. 空状态反馈

### 5.1 首次使用（无卡片）

```
┌─────────────────────────────────────────┐
│                                         │
│                                         │
│              ┌───────┐                  │
│              │  📝   │                  │ ← 插画（64px）
│              └───────┘                  │
│                                         │
│          欢迎使用 CardMind              │ ← H4
│                                         │
│     点击右下角 + 按钮创建第一张卡片     │ ← Body2
│                                         │
│         [创建卡片]  [查看指南]          │ ← 引导按钮
│                                         │
│                                ┌──────┐ │
│                                │  +   │ │ ← FAB（箭头指示）
│                                └──────┘ │
└─────────────────────────────────────────┘
  • 插画: 简洁线条风格，Primary-500
  • 引导: 箭头动画指向 FAB（1秒淡入淡出循环）
```

### 5.2 搜索无结果

```
┌─────────────────────────────────────────┐
│              ┌───────┐                  │
│              │  🔍   │                  │
│              └───────┘                  │
│                                         │
│          未找到相关卡片                 │
│                                         │
│      尝试使用其他关键词或清除筛选条件   │
│                                         │
│              [清除筛选]                 │
│                                         │
└─────────────────────────────────────────┘
```

### 5.3 笔记空间为空

```
┌─────────────────────────────────────────┐
│              ┌───────┐                  │
│              │  📁   │                  │
│              └───────┘                  │
│                                         │
│        此笔记空间还没有卡片            │
│                                         │
│      开始在这里记录你的想法和笔记       │
│                                         │
│              [创建卡片]                 │
│                                         │
└─────────────────────────────────────────┘
```

### 5.4 无可配对设备

```
┌─────────────────────────────────────────┐
│              ┌───────┐                  │
│              │  📡   │                  │
│              └───────┘                  │
│                                         │
│        未发现局域网设备                 │
│                                         │
│   请确保其他设备：                      │
│   • 已连接到同一 WiFi                   │
│   • 已启用 P2P 同步                     │
│   • CardMind 正在运行                   │
│                                         │
│            [刷新]  [帮助]               │
│                                         │
└─────────────────────────────────────────┘
```

**空状态设计原则**:
1. **友好的插画**: 64px 大小，线条风格，主色调
2. **清晰的说明**: 告诉用户为什么是空的
3. **引导操作**: 提供明确的下一步行动
4. **帮助入口**: 复杂场景提供帮助文档

---

## 6. 微交互反馈

### 6.1 按钮点击反馈

**主按钮（Filled Button）**:
```
正常:     背景 Primary-500
悬停:     背景 Primary-600 (Desktop)
按下:     背景 Primary-700 + 缩放 0.98
禁用:     背景 Neutral-300, 不透明度 0.38
```

**文字按钮（Text Button）**:
```
正常:     文字 Primary-500
悬停:     背景 Primary-100 (淡色圆形波纹)
按下:     背景 Primary-200 + 波纹扩散动画
```

**FAB（浮动按钮）**:
```
正常:     背景 Primary-500, 阴影 Level 4
悬停:     阴影 Level 5 (Desktop)
按下:     缩放 0.95 + 阴影 Level 3
```

**波纹动画**:
- 时长: 300ms
- 缓动: ease-out
- 颜色: Primary-500 @ 20% opacity

### 6.2 开关切换反馈

**Switch 动画**:
```
关 → 开:
  • 滑块从左滑到右（200ms）
  • 轨道颜色: Neutral-300 → Primary-500
  • 触觉反馈: 轻微震动（移动端）

开 → 关:
  • 滑块从右滑到左（200ms）
  • 轨道颜色: Primary-500 → Neutral-300
```

**状态指示**:
```
关闭: [○━━━━━] Neutral-300
开启: [━━━━━●] Primary-500
```

### 6.3 输入框焦点反馈

**正常 → 聚焦**:
```
正常: 边框 1px Neutral-300
聚焦: 边框 2px Primary-500 + 外发光（4px Primary-100）
动画: 200ms ease-out
```

**验证错误**:
```
错误: 边框 2px Error-Main + 外发光（4px Error-Light）
晃动: 水平晃动 3 次（300ms）
```

### 6.4 列表项交互

**点击反馈**:
```
正常:     背景 Transparent
按下:     背景 Neutral-100 (Light) / Neutral-800 (Dark)
释放:     300ms 淡出到 Transparent
```

**长按反馈**:
```
开始:     触觉反馈（移动端）
持续:     背景 Neutral-200 + 边框 2px Primary-500
菜单:     显示上下文菜单
```

### 6.5 卡片拖拽反馈（Phase 2）

```
拾起:     • 阴影 Level 5
          • 缩放 1.05
          • 轻微倾斜（旋转 3deg）
          • 触觉反馈

拖动中:   • 半透明（0.8）
          • 跟随手指/鼠标移动

放下:     • 缩放恢复 1.0
          • 阴影恢复 Level 2
          • 弹性动画（200ms）
```

---

## 7. 进度指示

### 7.1 线性进度条

**场景**: 文件上传、同步进度

```
[━━━━━━━━░░░░░░░░░░░░] 45%
```

**样式**:
- 高度: 8px
- 圆角: 4px
- 背景: Neutral-200 (Light) / Neutral-700 (Dark)
- 进度: Primary-500
- 动画: 流动光泽（1秒循环）

**不确定进度**:
```
[░░░░━━━━░░░░░░░░░░░░] ← 滑块左右移动
```

### 7.2 圆形进度指示器

**场景**: 按钮内加载、小区域加载

```
    ◐  ← 旋转动画
```

**样式**:
- 尺寸: 20px (小), 32px (中), 48px (大)
- 颜色: Primary-500
- 线宽: 3px
- 旋转: 顺时针，1.5秒/圈

### 7.3 下拉刷新

**场景**: 首页卡片列表刷新

```
状态 1 - 下拉:
┌─────────────────────────────────────────┐
│              ↓                          │ ← 箭头向下
│          下拉刷新                       │
└─────────────────────────────────────────┘

状态 2 - 释放刷新:
┌─────────────────────────────────────────┐
│              ↑                          │ ← 箭头向上
│          释放刷新                       │
└─────────────────────────────────────────┘

状态 3 - 加载中:
┌─────────────────────────────────────────┐
│              ◐                          │ ← 旋转动画
│          正在刷新...                    │
└─────────────────────────────────────────┘
```

---

## 8. 错误页面

### 8.1 网络错误

```
┌─────────────────────────────────────────┐
│                                         │
│              ┌───────┐                  │
│              │  📡   │                  │
│              └───────┘                  │
│                                         │
│          网络连接已断开                 │
│                                         │
│      请检查您的网络设置后重试            │
│                                         │
│            [重试]  [离线模式]           │
│                                         │
└─────────────────────────────────────────┘
```

### 8.2 数据损坏

```
┌─────────────────────────────────────────┐
│                                         │
│              ┌───────┐                  │
│              │  ⚠️   │                  │
│              └───────┘                  │
│                                         │
│          数据文件损坏                   │
│                                         │
│   尝试以下方法恢复：                    │
│   1. 重启应用                           │
│   2. 恢复最近备份                       │
│   3. 联系技术支持                       │
│                                         │
│        [重启]  [恢复备份]  [帮助]       │
│                                         │
└─────────────────────────────────────────┘
```

### 8.3 404 页面（未来功能）

```
┌─────────────────────────────────────────┐
│                                         │
│              ┌───────┐                  │
│              │  🔍   │                  │
│              └───────┘                  │
│                                         │
│          找不到这张卡片                 │
│                                         │
│   可能已被删除                          │
│                                         │
│              [返回首页]                 │
│                                         │
└─────────────────────────────────────────┘
```

---

## 9. 通知设计

### 9.1 应用内通知

**场景**: 后台同步完成、新设备发现

```
┌─────────────────────────────────────────┐
│ ┌─────────────────────────────────────┐ │ ← 从顶部滑下
│ │ 📱 新设备发现                       │ │
│ │                                     │ │
│ │ MacBook Pro 已连接到局域网          │ │
│ │                                     │ │
│ │          [忽略]        [配对]       │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
  • 位置: 顶部，AppBar 下方
  • 持续: 5秒（或手动关闭）
  • 动画: 从顶部滑入，淡出消失
```

### 9.2 系统通知（Phase 2）

**场景**: 应用在后台时的同步完成通知

```
CardMind
已同步 12 张新卡片
来自 iPhone 13 • 2分钟前
```

---

## 10. 反馈时机总结

| 操作 | 即时反馈（< 100ms） | 进度反馈（> 500ms） | 结果反馈 |
|------|---------------------|---------------------|----------|
| 点击按钮 | 波纹动画 | - | - |
| 创建卡片 | 页面切换动画 | - | Toast "卡片已创建" |
| 编辑卡片 | 输入响应 | 自动保存提示 | Toast "保存成功" |
| 删除卡片 | 按钮按下效果 | - | Snackbar "已删除 [撤销]" |
| P2P 同步 | 同步图标旋转 | 进度条（首次同步） | Toast "已同步 N 张卡片" |
| 密码验证 | 输入响应 | 验证中图标 | 成功/失败边框颜色 |
| 搜索 | 输入响应 | 骨架屏（> 200ms） | 结果列表或空状态 |

---

## 反馈设计原则

### 1. **即时响应**

- 任何操作必须在 100ms 内有视觉反馈
- 点击按钮 → 波纹动画
- 输入文字 → 立即显示

### 2. **进度可见**

- 超过 500ms 的操作显示加载状态
- 超过 2秒的操作显示进度条或骨架屏
- 超过 5秒的操作显示预计剩余时间

### 3. **清晰的状态**

- 同步状态实时更新（图标 + 颜色）
- 错误提示明确原因和解决方案
- 成功提示简洁清晰

### 4. **不打扰原则**

- Toast 自动消失，不阻塞操作
- 重要操作用对话框确认
- 非阻塞的 Snackbar 提供撤销机会

### 5. **一致性**

- 相同操作的反馈方式统一
- 颜色语义一致（绿=成功，红=错误，橙=警告）
- 动画时长和缓动曲线统一

### 6. **触觉反馈（移动端）**

- 按钮点击: 轻微震动（10ms）
- 开关切换: 轻微震动（10ms）
- 长按: 中等震动（30ms）
- 错误操作: 强震动（50ms）

---

**文档维护**:
- 此文档定义用户反馈规范，开发时必须遵循
- 如需调整反馈机制，需更新此文档并说明理由
- 实现细节参考代码：`lib/widgets/feedback/`

**相关文档**:
- 页面布局 → [ui_layouts.md](./ui_layouts.md)
- 页面流程 → [ui_flows.md](./ui_flows.md)
- 设计系统 → [ui_design_system.md](./ui_design_system.md)
