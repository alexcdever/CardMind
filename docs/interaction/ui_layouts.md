# UI 布局设计

**最后更新**: 2026-01-13

---

## 概述

本文档定义 CardMind 各页面的具体布局，包括组件位置、尺寸、间距等。所有布局遵循 [UI 设计系统](./ui_design_system.md) 中定义的基础规范。

**核心设计原则**:
- **单一笔记空间**: 笔记空间对用户透明，系统自动创建，用户无需理解"数据池"概念
- **快速捕捉**: 30秒内完成卡片创建，FAB 始终可触达
- **离线友好**: 清晰展示离线状态和同步状态
- **隐私保护**: 笔记空间密码验证流程清晰可靠

---

## 1. 首页 (Home)

### 布局结构

```
┌─────────────────────────────────────────┐
│ ┌─────────────────────────────────────┐ │ ← AppBar (56px)
│ │ CardMind                    🔍 ⋮             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────────┐ ┌─────────────────┐│ ← 卡片网格
│ │ 卡片 1          │ │ 卡片 2          ││   Padding: 16px
│ │                 │ │                 ││   Gap: 16px
│ └─────────────────� └─────────────────┘│
│ ┌─────────────────┐ ┌─────────────────┐│
│ │ 卡片 3          │ │ 卡片 4          ││
│ │                 │ │                 ││
│ └──────────────────└─────────────────┘│
│                                         │
│                                ┌──────┐ │ ← FAB (56x56px)
│                                │  +   │ │   右下角 16px
│                                └──────┘ │
└─────────────────────────────────────────┘
```

### 组件清单

| 组件 | 说明 | 尺寸/位置 |
|------|------|----------|
| **AppBar** | 顶部导航栏 | 高度 56px |
| - 应用标题 | "CardMind" | 居中（可选） |
| - 搜索图标 | 打开搜索页 | 右侧第二个 |
| - 更多菜单 | 设置、退出笔记空间、帮助 | 右侧第一个 |
| **卡片网格** | 当前笔记空间的卡片列表 | 响应式列数 |
| **FAB** | 快速创建卡片 | 56x56px，右下 16px |

### 响应式布局

| 屏幕 | AppBar | 卡片列数 | FAB |
|------|--------|----------|-----|
| Mobile (< 600px) | 标题隐藏 | 1列 | 显示 |
| Tablet (600-1024px) | 标题显示 | 2列 | 显示 |
| Desktop (> 1024px) | 标题显示 | 3列 | 可选隐藏 |



---

## 2. 卡片列表页 (Card List)

已在"首页"部分定义，补充视图模式：

### 列表视图模式

```
┌─────────────────────────────────────────┐
│ ┌─────────────────────────────────────┐ │
│ │ 如何设计数据库索引            14:32 │ │ ← 卡片标题 + 时间
│ │ 索引可以加速查询，但会降低写入... │ │   摘要（2行截断）
│ │ #数据库 #性能                       │ │   标签
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ 产品设计原则                  昨天  │ │
│ │ 简洁专注、快速响应、轻量舒适... │ │
│ │ #产品 #设计                         │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

**卡片尺寸**:
- 高度: 自适应（最小 80px）
- 内边距: 16px
- 间距: 12px

### 网格视图模式

```
┌──────────────────┐ ┌──────────────────┐
│ 如何设计数据库   │ │ 产品设计原则     │
│                  │ │                  │
│ 索引可以加速查询 │ │ 简洁专注、快速   │
│ ...              │ │ ...              │
│                  │ │                  │
│ #数据库 #性能    │ │ #产品 #设计      │
│            14:32 │ │            昨天   │
└──────────────────┘ └──────────────────┘
```

**卡片尺寸**:
- 宽度: 响应式（见"首页"响应式布局）
- 高度: 自适应（最小 120px）
- 内边距: 12px
- 间距: 16px

---

## 3. 卡片详情页 (Card Detail)

### 布局结构

```
┌─────────────────────────────────────────┐
│ ┌─────────────────────────────────────┐ │ ← AppBar (56px)
│ │ ← 返回         [编辑] [⋮]           │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│                                         │ ← 内容区
│ ← 24px → [卡片内容区，最大 800px] ← 24px→│   居中，最大宽度
│                                         │
│   如何设计数据库索引                    │   标题 H3
│                                         │
│   索引是数据库中用于加速查询的数据结构  │   正文 Body2
│   常见的索引类型包括：                  │   支持 Markdown
│                                         │
│   1. B-Tree 索引                        │
│   2. Hash 索引                          │
│   ...                                   │
│                                         │
│   ```sql                                │   代码块
│   CREATE INDEX idx_name ON table(col);  │
│   ```                                   │
│                                         │
│   #数据库 #性能 #后端                   │   标签（底部）
│                                         │
│   创建于 2026-01-08 14:32               │   元数据（Caption）
│   最后编辑 2026-01-08 15:20             │
│                                         │
└─────────────────────────────────────────┘
```

### 组件清单

| 区域 | 说明 | 样式 |
|------|------|------|
| **内容区** | 卡片内容展示 | 最大宽度 800px，居中 |
| - 标题 | Markdown H1-H3 | H3 字体（24px） |
| - 正文 | Markdown 内容 | Body2 字体（14px） |
| - 代码块 | 语法高亮 | 等宽字体 + 背景色 |
| - 标签 | 卡片标签 | 芯片样式，可点击 |
| - 元数据 | 创建时间、最后编辑时间 | Caption 字体（12px） |
| **AppBar** | 顶部操作栏 | - |
| - 编辑按钮 | 进入编辑模式 | 文字按钮 |
| - 更多菜单 | 删除、分享等 | 图标按钮 |

### Markdown 渲染样式

参考 [UI 设计系统 - Markdown 排版映射](./ui_design_system.md#markdown-排版映射)

**代码块样式**:
```
背景: Neutral-100 (Light) / Neutral-800 (Dark)
边框: 1px solid Neutral-300 (Light) / Neutral-600 (Dark)
圆角: 8px
内边距: 12px 16px
字体: Monospace, 14px
```

**引用样式**:
```
左边框: 4px solid Primary-500
背景: Primary-50 (Light) / Primary-900 (Dark)
内边距: 12px 16px
斜体: 是
```

---

## 4. 卡片编辑页 (Card Editor)

### 布局结构

```
┌─────────────────────────────────────────┐
│ ┌─────────────────────────────────────┐ │ ← AppBar (56px)
│ │ [取消]  编辑卡片           [完成]   │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │ ← 工具栏 (48px)
│ │ B I U ≡ • 1. [] 📎 #               │ │   Markdown 工具
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│                                         │ ← 编辑器
│ ← 16px → [编辑器，最大 800px]  ← 16px → │
│                                         │
│   # 如何设计数据库索引|                 │   实时预览（可选）
│                                         │   | = 光标
│   索引是数据库中用于加速查询...         │
│                                         │
└─────────────────────────────────────────┘
```

### 组件清单

| 区域 | 说明 | 功能 |
|------|------|------|
| **AppBar** | 顶部操作栏 | - |
| - 取消按钮 | 退出编辑（未保存提示） | 文字按钮 |
| - 完成按钮 | 保存并返回 | 主按钮 |
| **工具栏** | Markdown 快捷插入 | 横向滚动 |
| - 格式按钮 | 粗体、斜体、下划线 | 图标按钮（20px） |
| - 列表按钮 | 无序、有序、复选框 | 图标按钮 |
| - 附件按钮 | 插入图片（Phase 2） | 图标按钮 |
| - 标签按钮 | 添加标签 | 图标按钮 |
| **编辑器** | Markdown 编辑器 | 多行文本输入 |

### 编辑器详细设计

**自动保存提示**:
```
位置: 底部栏中间
文字: "已自动保存" / "保存中..." / "保存失败"
颜色: Neutral-500 / Primary-500 / Error-Main
```

**Markdown 工具栏按钮**:
| 按钮 | 图标 | 插入内容 |
|------|------|----------|
| 粗体 | **B** | `**文字**` |
| 斜体 | *I* | `*文字*` |
| 下划线 | U | `~~文字~~` |
| 标题 | ≡ | `# ` |
| 无序列表 | • | `- ` |
| 有序列表 | 1. | `1. ` |
| 复选框 | [] | `- [ ] ` |
| 代码块 | `<>` | ` ``` ` |
| 标签 | # | 打开标签选择器 |

---

## 5. 同步状态页 (Sync Status)

从首页 AppBar 的"更多菜单"进入。

### 布局结构

```
┌─────────────────────────────────────────┐
│ ┌─────────────────────────────────────┐ │ ← AppBar
│ │ ← 同步状态                          │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │ ← 总体状态卡片
│ │ ✓ 笔记空间已同步                   │ │
│ │   最后同步: 2分钟前                 │ │
│ │   [立即同步]                        │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 已连接设备                              │ ← Section 标题
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 📱 我的iPhone (iPhone-018c8)        │ │ ← 已配对设备
│ │    192.168.1.100                    │ │   显示自定义昵称（主）
│ │    已配对 • 最后同步: 2分钟前       │ │   + mDNS昵称（辅助）
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 💻 MacBook Pro (MacBook-7a3e1)     │ │
│ │    192.168.1.101                    │ │
│ │    已配对 • 最后同步: 5分钟前       │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 局域网设备                              │ ← Section 标题
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 💻 iPad-Air (iPad-9f2a1)           │ │ ← 未配对设备
│ │    192.168.1.102                    │ │   仅显示 mDNS 默认昵称
│ │    [配对]                           │ │ ← 需要密码验证
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 同步状态指示器

| 状态 | 图标 | 颜色 | 说明 |
|------|------|------|------|
| 已同步 | ✓ | Success-Main | 所有设备数据一致 |
| 同步中 | 🔄 | Primary-500 | 正在传输数据 |
| 未同步 | ⚠️ | Warning-Main | 有未同步的变更 |
| 冲突 | ⚠️ | Error-Main | 需要手动解决（罕见） |
| 离线 | - | Neutral-500 | 未启用同步 |

### 设备昵称显示规则

**重要**: CardMind 有两种设备昵称，用于不同场景。

#### 1. mDNS 默认昵称（用于广播和发现）
- **格式**: `{设备型号}-{UUID前5位}`
- **示例**: `iPhone-018c8`, `MacBook-7a3e1`
- **生成**: 自动生成，不可修改
- **用途**: mDNS 广播、未配对设备显示
- **隐私**: 不包含用户个人信息

#### 2. 笔记空间自定义昵称（用于成员列表）
- **格式**: 用户自定义，1-64 字符
- **示例**: `我的iPhone`, `工作电脑`, `家里的iPad`
- **生成**: 用户在配对时或笔记空间设置中自定义
- **用途**: 笔记空间成员列表、已配对设备显示
- **特性**: 每个设备在笔记空间中有一个昵称

**显示逻辑**:
| 场景 | 显示内容 | 示例 |
|------|----------|------|
| 未配对设备 | mDNS 默认昵称 | `MacBook-7a3e1` |
| 已配对设备（有自定义昵称） | 自定义昵称（主）+ mDNS 昵称（辅助） | `我的iPhone (iPhone-018c8)` |
| 已配对设备（无自定义昵称） | mDNS 默认昵称 | `iPhone-018c8` |
| 笔记空间成员列表 | 优先显示自定义昵称 | `我的iPhone` |

**设计理由**:
- **mDNS 广播使用默认昵称**: 避免泄露用户个人信息
- **支持自定义昵称**: 用户可以为设备设置易识别的昵称
- **自动生成默认昵称**: 即使用户不自定义，也有可识别的昵称

### 设备配对流程

点击未配对设备的"[配对]"按钮：

```
┌─────────────────────────────────────────┐
│ 配对设备                           ✕    │
├─────────────────────────────────────────┤
│                                         │
│ 设备信息:                               │
│   mDNS 昵称: MacBook-7a3e1              │ ← 默认昵称
│   IP: 192.168.1.102                     │
│                                         │
│ 自定义昵称（可选）:                     │
│ ┌─────────────────────────────────────┐ │
│ │ 我的MacBook                         │ │ ← 用户输入
│ └─────────────────────────────────────┘ │
│ 留空则使用默认昵称                      │
│                                         │
│ 输入笔记空间密码:                       │
│ ┌─────────────────────────────────────┐ │
│ │ ••••••••                  👁         │ │
│ └─────────────────────────────────────┘ │
│ 用于验证设备身份                        │
│                                         │
│          [取消]          [配对]         │
│                                         │
└─────────────────────────────────────────┘
```

**验证流程**:
1. 输入笔记空间密码
2. 设备间验证密码（P2P 加密通信）
3. 验证成功 → 开始同步
4. 验证失败 → 显示错误提示

---

## 6. 设置页 (Settings)

### 布局结构

```
┌─────────────────────────────────────────┐
│ ┌─────────────────────────────────────┐ │ ← AppBar
│ │ ← 设置                              │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 数据与同步                              │ ← Section
│ ┌─────────────────────────────────────┐ │
│ │ 同步设置                        >   │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ 导出数据                        >   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 外观                                    │
│ ┌─────────────────────────────────────┐ │
│ │ 主题模式          [浅色 ▼]          │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ 字体大小          [标准 ▼]          │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 编辑器                                  │
│ ┌─────────────────────────────────────┐ │
│ │ 自动保存                    [●━━]   │ │ ← Switch
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ Markdown 工具栏              [●━━]   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 关于                                    │
│ ┌─────────────────────────────────────┐ │
│ │ 版本                    v1.0.0      │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ 用户指南                        >   │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ 开源许可                        >   │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 设置项列表

| Section | 设置项 | 类型 | 说明 |
|---------|--------|------|------|
| **数据与同步** | | | |
| | 同步设置 | 导航 | P2P 同步配置 |
| | 导出数据 | 导航 | 导出为 JSON/Markdown |
| **外观** | | | |
| | 主题模式 | 下拉 | 浅色/深色/跟随系统 |
| | 字体大小 | 下拉 | 小/标准/大/特大 |
| **编辑器** | | | |
| | 自动保存 | 开关 | 默认开启 |
| | Markdown 工具栏 | 开关 | 默认开启 |
| | 实时预览 | 开关 | 默认关闭（Phase 2） |
| **关于** | | | |
| | 版本 | 只读 | 当前版本号 |
| | 用户指南 | 导航 | 打开帮助文档 |
| | 开源许可 | 导航 | 显示许可证 |

---

## 9. 搜索页 (Search)

点击首页 AppBar 的搜索图标进入。

### 布局结构

```
┌─────────────────────────────────────────┐
│ ┌─────────────────────────────────────┐ │ ← 搜索栏 (56px)
│ │ ← [搜索卡片...]             🔍       │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │ ← 筛选栏 (48px)
│ │ 所有数据池 ▼  所有标签 ▼  时间 ▼   │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│                                         │ ← 搜索结果
│ ┌─────────────────────────────────────┐ │
│ │ 如何设计数据库索引            14:32 │ │
│ │ 索引是数据库中用于加速查询的...     │ │ ← 高亮匹配词
│ │ #数据库 #性能                       │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 数据库优化技巧                昨天  │ │
│ │ ...索引...分区表...               │ │
│ │ #数据库                             │ │
│ └─────────────────────────────────────┘ │
│                                         │
│           找到 12 张卡片                │ ← 结果统计
│                                         │
└─────────────────────────────────────────┘
```

### 搜索功能

**全文搜索**:
- 搜索范围: 标题 + 内容
- 技术: SQLite FTS5
- 高亮: 匹配词用 Primary-500 背景高亮

**筛选条件**:
- 数据池: 单选，默认"所有数据池"
- 标签: 多选，支持同时筛选多个标签
- 时间: 今天/最近7天/最近30天/自定义

**搜索历史** (输入框未聚焦时显示):
```
┌─────────────────────────────────────┐
│ 最近搜索                            │
│ • 数据库索引                        │
│ • P2P 同步                          │
│ • Markdown 语法                     │
└─────────────────────────────────────┘
```

---

## 10. 空状态设计

### 首次使用（无卡片）

```
┌─────────────────────────────────────────┐
│                                         │
│              ┌───────┐                  │
│              │  📝   │                  │ ← 插画（64px）
│              └───────┘                  │
│                                         │
│          欢迎使用 CardMind              │ ← H4
│                                         │
│     点击右下角 + 按钮创建第一张卡片     │ ← Body2
│                                         │
│         [创建卡片]  [查看指南]          │ ← 引导按钮
│                                         │
│                                ┌──────┐ │
│                                │  +   │ │ ← FAB（强调）
│                                └──────┘ │
└─────────────────────────────────────────┘
```

### 搜索无结果

```
┌─────────────────────────────────────────┐
│              ┌───────┐                  │
│              │  🔍   │                  │
│              └───────┘                  │
│                                         │
│          未找到相关卡片                 │
│                                         │
│      尝试使用其他关键词或清除筛选条件   │
│                                         │
│              [清除筛选]                 │
│                                         │
└─────────────────────────────────────────┘
```

### 数据池为空

```
┌─────────────────────────────────────────┐
│              ┌───────┐                  │
│              │  📁   │                  │
│              └───────┘                  │
│                                         │
│        此数据池还没有卡片               │
│                                         │
│      开始在这里记录你的想法和笔记       │
│                                         │
│              [创建卡片]                 │
│                                         │
└─────────────────────────────────────────┘
```

---

## 11. 响应式布局总结

### 断点定义

| 断点 | 屏幕宽度 | 设备 | 布局调整 |
|------|----------|------|----------|
| Mobile | < 600px | 手机 | 单列，大触摸区域 |
| Tablet | 600-1024px | 平板 | 双列，利用空间 |
| Desktop | > 1024px | 电脑 | 三列，侧边栏可展开 |

### 各页面响应式适配

| 页面 | Mobile | Tablet | Desktop |
|------|--------|--------|---------|
| 首页 | 单列卡片 | 双列卡片 | 三列卡片 |
| 卡片详情 | 全宽（16px边距） | 居中（最大800px） | 居中（最大800px） |
| 卡片编辑 | 全宽 | 居中（最大800px） | 居中（最大800px） |
| 同步状态 | 单列列表 | 单列列表 | 双列布局 |
| 设置 | 单列列表 | 居中（最大600px） | 居中（最大600px） |

### Desktop 特殊适配

Desktop 版本无需特殊适配，所有页面保持居中布局。

---

## 组件复用清单

以下组件在多个页面中复用，需提取为独立组件：

| 组件名 | 用途 | 使用页面 |
|--------|------|----------|
| `CardListItem` | 卡片列表项 | 首页、搜索结果 |
| `SyncStatusIndicator` | 同步状态图标 | 同步状态 |
| `EmptyState` | 空状态占位 | 首页、搜索 |
| `PasswordInput` | 密码输入框 | 设备配对 |
| `BottomSheetDialog` | 底部抽屉 | 选项选择 |

---

## 设计决策记录

### 为什么 FAB 在手机上不可隐藏？

1. **核心任务**: "30秒创建卡片"是核心指标
2. **触达性**: 拇指区域，随时可点击
3. **视觉提示**: 新用户清楚知道如何创建卡片

### 为什么卡片详情最大宽度 800px？

1. **阅读舒适**: 60-80 字符/行是最佳宽度（见 UI 设计系统）
2. **避免过宽**: 大屏上全宽阅读体验差
3. **居中聚焦**: 内容居中，减少干扰

### 为什么同步状态独立成页？

1. **设备管理**: 多设备配对和状态监控需要独立页面
2. **可调试性**: 用户需要清楚看到每个设备的同步情况
3. **隐私保护**: 设备配对需要完整的密码验证流程

### 为什么采用单一笔记空间模型？

1. **简化体验**: 用户无需理解"数据池"概念，系统自动管理
2. **零配置**: 新用户创建笔记空间后即可开始使用
3. **隐私隔离**: 每个用户/家庭有独立的笔记空间
4. **降低复杂度**: 避免多数据池切换、卡片绑定管理等复杂操作

---

**文档维护**:
- 此文档定义页面布局规范，开发时必须遵循
- 如需调整布局，需更新此文档并说明理由
- 实现细节参考代码：`lib/screens/`

**相关文档**:
- 设计基础 → [ui_design_system.md](./ui_design_system.md)
- 页面流程 → [ui_flows.md](./ui_flows.md)
- 反馈设计 → [feedback_design.md](./feedback_design.md)
