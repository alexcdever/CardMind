# 信息架构

**最后更新**: 2026-01-08

---

## 概述

本文档定义 CardMind 的信息组织和导航结构，确保用户清楚知道：
1. **我在哪里？** （当前位置）
2. **能去哪里？** （可访问的内容）
3. **如何找到内容？** （搜索和筛选）

**核心原则**:
- **笔记空间作为顶层维度**: 每个用户只有一个笔记空间，用于隔离数据
- **扁平化层级**: 最多 3 层（卡片列表 → 卡片详情），避免深层嵌套
- **上下文清晰**: 始终显示当前笔记空间，明确用户所在位置
- **快速访问**: 高频功能（创建、搜索）始终可达

---

## 1. 信息层级结构

### 1.1 层级定义

```
应用层级结构:

Level 0: 应用（CardMind）
  │
  ├─ Level 1: 笔记空间（顶层维度）
  │    │
  │    └─ Level 2: 卡片列表
  │    │   │
  │    │   ├─ 卡片 1
  │    │   ├─ 卡片 2
  │    │   └─ ...
  │    │
  │    └─ Level 3: 卡片详情
  │         └─ 内容、标签、元数据
  │
  ├─ 特殊页面
  │    ├─ 搜索
  │    ├─ 设置
  │    └─ 退出笔记空间（罕见）
  │
  └─ 功能入口
       ├─ 快速创建（FAB）
       ├─ 搜索
       └─ 更多菜单
```

### 1.1.1 单一笔记空间架构

**设计决策**: 每个用户只有一个笔记空间，用于隔离不同用户的数据（如家庭成员各用各的）。

**关键原则**:
- **一用户一空间**: 用户无需创建多个空间，系统自动创建"我的笔记"空间
- **一设备一空间**: 每个设备只能加入一个笔记空间
- **零配置**: 笔记空间对用户透明，用户只需设置密码
- **极简体验**: 无需切换笔记空间、无需选择常驻池

### 1.2 笔记空间作为顶层维度

**设计决策**: 笔记空间是信息组织的**最高层级**，原因：

1. **隐私隔离**: 不同用户的笔记空间完全隔离（家庭成员各用各的）
2. **同步控制**: 每个笔记空间独立配置同步策略
3. **用户隔离**: 单一用户 = 单一笔记空间，符合"个人笔记"定位
4. **安全性**: 笔记空间级别的密码保护

**与其他层级的关系**:
- 卡片**必须**归属于笔记空间
- 标签在笔记空间内有效（不跨空间共享）
- 搜索默认在当前笔记空间内，无"所有空间"选项

---

## 2. 导航体系

### 1.2 主导航结构

CardMind 使用**单层导航**（无 Tab 或 Drawer），简化信息架构。

```
┌─────────────────────────────────┐
│ [笔记空间] CardMind      🔍 ⋮        │ ← AppBar（全局导航）
├─────────────────────────────────┤
│                                         │ ← 内容区
│          [卡片列表区域]              │
│                                         │
│                                ┌──────┐ │ ← FAB（快速操作）
│                                │  +   │ │
│                                └──────┘ │
└─────────────────────────────────┘
```

**导航层级**:
- **Level 1**: AppBar（应用级导航）
- **Level 2**: FAB + 搜索（功能入口）

### 2.2 AppBar 导航

**组件**: `[笔记空间名称] [标题] [搜索] [更多菜单]`

| 元素 | 功能 | 目标 |
|------|------|------|
| 笔记空间名称 | 显示当前笔记空间名称（如"我的笔记"） | 明确用户所在位置 |
| 标题 | 显示应用名称（可选） | 品牌展示 |
| 搜索图标 | 打开搜索页 | 全局搜索 |
| 更多菜单 | 打开菜单 | 同步状态、设置、帮助 |

**更多菜单内容**:
```
┌─────────────────────────┐
│ 同步状态            >   │
├─────────────────────────┤
│ 设置                >   │
│ 帮助与反馈          >   │
│ 关于                >   │
└─────────────────────────┘
```

### 2.3 FAB（浮动操作按钮）

**功能**: 快速创建卡片（最高频操作）

```
┌──────┐
│  +   │ ← 56x56px, Primary-500
└──────┘
  位置: 右下角，距离边缘 16px
  阴影: Level 4
  点击: 打开卡片编辑页
```

**始终可见**: 除了以下页面外，FAB 在所有页面显示
- 卡片编辑页（避免遮挡内容）
- 设置页（非内容创建场景）

---

## 3. 页面架构

### 3.1 页面地图

```
CardMind
│
├─ 首页（Home）
│   • 当前笔记空间的卡片列表
│   • 默认视图: 网格/列表（用户可切换）
│   • 排序: 最新创建、最后编辑、标题A-Z
│
├─ 卡片详情（Card Detail）
│   • 阅读模式，Markdown 渲染
│   • 元数据: 时间、标签
│   • 操作: 编辑、删除、分享
│
├─ 卡片编辑（Card Editor）
│   • Markdown 编辑器
│   • 工具栏: 格式、插入、标签
│   • 自动保存
│
├─ 搜索（Search）
│   • 全文搜索（FTS5）
│   • 筛选: 标签、时间
│   • 搜索历史
│
├─ 同步状态（Sync Status）
│   • 笔记空间同步状态
│   • 已连接设备列表
│   • 设备配对
│
├─ 设置（Settings）
│   • 数据管理
│   • 外观
│   • 编辑器
│   • 关于
│
└─ 退出笔记空间（罕见操作）
```

### 3.2 页面跳转关系

```
[首页] ←→ 入口页面，大部分操作从这里开始
   │
   ├─ 点击 FAB ──────────→ [卡片编辑页 - 新建]
   │                         │
   │                         └─ 完成 ──→ [首页]（新卡片出现）
   │
   ├─ 点击卡片 ──────────→ [卡片详情页]
   │                         │
   │                         ├─ 编辑 ──→ [卡片编辑页 - 编辑]
   │                         │             │
   │                         │             └─ 完成 ──→ [卡片详情页]
   │                         │
   │                         └─ 返回 ──→ [首页]
   │
   ├─ 点击搜索图标 ──────→ [搜索页]
   │                         │
   │                         └─ 点击结果 ──→ [卡片详情页]
   │
   ├─ 点击更多菜单 ──────→ [菜单]
   │                         │
                             ├─ 设置 ──→ [设置页]
                             └─ 关于 ──→ [关于页]
   │
   └─ 启动时 ──────────→ [初始化流程]
                         │
                         ├─ 已加入空间 → [首页]
                         ├─ 未加入空间 ──→ [设备发现页]
                         │     ├─ 发现设备 ──→ [配对界面]
                         │     │           └─ [首页]
                         │     └─ 无设备/选择创建 ──→ [创建向导]
                         │                 └─ [首页]
```

---

## 4. 内容组织

### 4.1 卡片排序

**默认排序**: 最后编辑时间（降序）

**可选排序**:
| 排序方式 | 规则 | 场景 |
|----------|------|------|
| 最新创建 | created_at DESC | 查看最近捕捉的想法 |
| 最后编辑 | updated_at DESC | 查看最近修改的内容（默认） |
| 标题 A-Z | title ASC | 按标题字母顺序查找 |
| 标题 Z-A | title DESC | 按标题倒序查找 |

**未来扩展**（Phase 2+）:
- 按标签分组
- 按时间线（年-月-日）
- 自定义排序

### 4.2 卡片筛选

**筛选维度**:

| 维度 | 类型 | 选项 |
|------|------|------|
| 标签 | 多选 | 所有标签列表（按使用频率排序） |
| 时间 | 单选 | 今天 / 最近7天 / 最近30天 / 自定义 |
| 状态 | 单选 | 全部（默认）/ 已删除（回收站） |

**筛选条件显示**:
```
首页顶部（当有筛选条件时）:
┌─────────────────────────────────────────┐
│ 筛选: #产品 #设计 • 最近7天  [✕ 清除]  │
└─────────────────────────────────────────┘
```

### 4.3 标签系统

**标签归属**: 标签在**笔记空间内有效**

**标签结构**:
```
笔记空间: 我的笔记
  ├─ #产品 (23 张卡片)
  ├─ #设计 (15 张卡片)
  └─ #技术 (31 张卡片)
```

**标签管理**:
- 创建: 编辑卡片时添加新标签
- 删除: 删除所有使用该标签的卡片后，标签自动消失
- 重命名: 批量修改标签名称（Phase 2）
- 合并: 将两个标签合并为一个（Phase 2）

---

## 5. 搜索架构

### 5.1 搜索范围

**搜索范围**: 当前笔记空间

**搜索字段**:

**全文搜索字段**:
| 字段 | 权重 | 说明 |
|------|------|------|
| 标题 | 高 | 标题匹配优先级最高 |
| 内容 | 中 | 正文内容全文搜索 |
| 标签 | 高 | 标签完全匹配 |

**搜索结果排序**:
1. 标题完全匹配
2. 标签完全匹配
3. 标题部分匹配
4. 内容匹配（按相关性得分）
5. 最后编辑时间（相关性相同时）

### 5.2 搜索历史

**存储策略**:
- 最多存储 20 条搜索历史
- 按时间倒序排列
- 重复关键词只保留最新一次

**隐私保护**:
- 搜索历史存储在本地
- 用户可清除全部历史
- 不同数据池的搜索历史独立（可选）

---

## 6. 上下文与位置指示

### 6.1 面包屑导航

**使用场景**: 深层页面（卡片详情、编辑页）

```
卡片详情页:
┌─────────────────────────────────────────┐
│ ← 我的笔记                 [编辑] [⋮]   │ ← 返回 + 笔记空间名称
└─────────────────────────────────────────┘

卡片编辑页:
┌─────────────────────────────────────────┐
│ [取消]  编辑卡片 - 我的笔记    [完成]   │ ← 笔记空间上下文
└─────────────────────────────────────────┘
```

**信息层级**:
- **返回按钮**: 清晰标注返回目标（笔记空间名称）
- **标题**: 显示当前操作（编辑卡片）
- **子标题**: 显示上下文（所属笔记空间）

### 6.2 当前位置指示

**底部导航**（Phase 2，如果引入）:
```
┌─────────────────────────────────────────┐
│  📝       🔍       ⚙️                   │
│ 卡片     搜索     设置                  │
│  ●        ○        ○   ← 当前页指示    │
└─────────────────────────────────────────┘
```

### 6.3 返回逻辑

**原则**: 用户期望的返回路径，而非技术栈顺序

| 当前页面 | 点击返回 | 目标页面 |
|----------|----------|----------|
| 首页 | 系统返回 | 退出应用 |
| 卡片详情 | ← 返回 | 首页 |
| 卡片编辑 | [取消] | 首页 或 卡片详情（来源页） |
| 搜索页 | ← 返回 | 首页 |
| 搜索结果 → 卡片详情 | ← 返回 | 搜索结果页 |
| 同步状态 | ← 返回 | 首页 |
| 设置 | ← 返回 | 首页 |

**特殊情况**:
- 卡片编辑页未保存 → 显示"放弃编辑"确认对话框
- 深链接进入卡片详情 → 返回到首页

---

## 7. 信息密度

### 7.1 卡片列表信息密度

**网格视图**（适合浏览）:
```
┌──────────────────┐
│ 如何设计数据库索 │ ← 标题（2行截断）
│ 引                │
│                  │
│ 索引可以加速查询 │ ← 摘要（3行截断）
│ ，但会降低写入性 │
│ 能...            │
│                  │
│ #数据库 #性能    │ ← 标签（最多3个）
│            14:32 │ ← 时间
└──────────────────┘
```

**列表视图**（适合快速扫描）:
```
┌─────────────────────────────────────────┐
│ 如何设计数据库索引            14:32     │ ← 标题（1行） + 时间
│ 索引可以加速查询，但会降低写入性能...   │ ← 摘要（2行截断）
│ #数据库 #性能                           │ ← 标签
└─────────────────────────────────────────┘
```

**信息优先级**:
1. 标题（最重要，粗体）
2. 摘要（帮助快速判断内容）
3. 标签（分类标识）
4. 时间（次要信息，右对齐）

### 7.2 卡片详情信息层级

```
┌─────────────────────────────────────────┐
│ [标题 - H3]                             │ ← 最高层级
│                                         │
│ [正文内容 - Body2]                      │ ← 主要内容
│ • Markdown 渲染                         │
│ • 图片（Phase 2）                       │
│ • 代码块                                │
│                                         │
│ [标签] [标签] [标签]                    │ ← 分类信息
│                                         │
│ ───────────────────────────────────────│ ← 分割线
│                                         │
│ 创建于 2026-01-08 14:32                 │ ← 元数据（次要）
│ 最后编辑 2026-01-08 15:20               │
└─────────────────────────────────────────┘
```

**视觉层级**:
- 标题: H3 (24px), 粗体
- 正文: Body2 (14px), 常规
- 标签: Caption (12px), 芯片样式
- 元数据: Caption (12px), 灰色

---

## 8. 笔记空间隔离策略

### 8.1 隔离原则

**完全隔离**:
- 卡片: 只显示当前笔记空间的卡片
- 标签: 标签在笔记空间内有效
- 搜索: 只搜索当前笔记空间
- 统计: 卡片数量、标签统计仅限当前笔记空间

**用户隔离**:
- 每个用户只有一个笔记空间
- 不同用户的笔记空间完全隔离
- 笔记空间通过密码保护

### 8.2 笔记空间状态保持

**状态保持策略**:
- 笔记空间保存:
  - 滚动位置
  - 筛选条件
  - 排序方式
  - 视图模式（网格/列表）
- 返回首页时恢复状态，提升体验

---

## 9. 未来扩展

### 9.1 智能分组（Phase 3）

**按时间分组**:
```
今天
  • 卡片 1
  • 卡片 2

昨天
  • 卡片 3
  • 卡片 4

本周
  • 卡片 5
  • ...
```

**按标签分组**:
```
#产品
  • 卡片 1
  • 卡片 2

#设计
  • 卡片 3
  • 卡片 4

未分类
  • 卡片 5
```

### 9.2 工作区（Phase 4）

**概念**: 在数据池内创建临时工作区，聚合相关卡片

```
数据池: 工作笔记
  │
  ├─ 工作区: 产品设计
  │    • 相关卡片: 15 张
  │    • 临时性，可随时删除
  │
  ├─ 工作区: 技术调研
  │    • 相关卡片: 8 张
  │
  └─ 所有卡片（默认视图）
```

**与数据池的区别**:
- 工作区是临时性的，数据池是永久性的
- 卡片可以同时属于多个工作区
- 工作区不影响同步策略

### 9.3 双向链接（Phase 5）

**概念**: 卡片之间的链接关系

```
卡片 A: "如何设计数据库索引"
  ↓ 链接到
卡片 B: "B-Tree 原理"
  ↑ 被链接（反向链接）
卡片 A
```

**信息架构影响**:
- 卡片详情页显示"相关卡片"区块
- 支持链接图谱可视化（Phase 6）

---

## 10. 信息架构决策记录

### 为什么数据池是顶层维度？

1. **隐私优先**: 用户最关心的是工作/生活数据隔离
2. **同步控制**: 数据池是同步的基本单位
3. **认知模型**: 符合用户心智模型（我有多个独立的笔记本）

### 为什么标签不跨数据池？

1. **避免混乱**: 不同数据池的标签语义可能冲突
2. **隐私保护**: 工作标签不应在个人数据池出现
3. **简化管理**: 减少标签数量，避免标签爆炸

### 为什么不使用文件夹/层级？

1. **扁平化**: 避免深层嵌套，降低认知负担
2. **灵活性**: 标签比文件夹更灵活（一张卡片多个标签）
3. **搜索优先**: 现代应用强调搜索而非层级浏览

### 为什么不使用底部导航栏？

1. **简化架构**: 只有一个核心页面（卡片列表）
2. **FAB 更快**: 创建卡片（最高频操作）用 FAB 更快
3. **避免混淆**: 数据池切换已经是一层导航，不需要第二层

---

**文档维护**:
- 此文档定义信息架构，开发时必须遵循
- 如需调整架构，需更新此文档并记录理由
- 实现细节参考代码：`lib/navigation/` 和 `lib/models/`

**相关文档**:
- 页面布局 → [ui_layouts.md](./ui_layouts.md)
- 页面流程 → [ui_flows.md](./ui_flows.md)
- 反馈设计 → [feedback_design.md](./feedback_design.md)
- 产品愿景 → [product_vision.md](../requirements/product_vision.md)
