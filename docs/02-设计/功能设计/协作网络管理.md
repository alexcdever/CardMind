# 协作网络管理

## 介绍

协作网络管理负责CardMind应用的设备协作、网络认证和数据同步功能，确保多个设备能够安全、高效地协同工作并保持数据一致。协作网络是设备协同的核心概念，每个网络包含多个设备，设备间通过该网络实现数据同步。

## 属性

- **唯一ID**: 协作网络的唯一标识符，基于UUID v4生成
- **昵称**: 用于用户识别的显示名称
- **设备列表**: 记录网络内所有设备的信息，包含每个设备的设备ID和设备昵称

## 功能

### 增

#### 添加协作网络
- 支持创建新的协作网络
- 初始网络创建：App初始化自动生成设备ID时，默认创建一个名为"local"的协作网络，其昵称为"local"
- 其他新创建的网络，默认昵称为网络ID的前5位字符

### 删

#### 删除协作网络
- 支持删除已创建的协作网络
- 删除操作需要考虑已绑定的卡片数据处理

### 改

#### 修改协作网络昵称
- 支持对已创建的协作网络进行重命名操作
- 默认创建的"local"网络可被重命名
- 网络昵称修改后，在所有加入该网络的设备上同步更新
- 网络昵称仅用于显示，不影响网络ID和数据流转

### 查

#### 协作网络列表
- 显示设备已加入的所有协作网络
- 每个网络显示网络昵称、网络ID等信息

#### 协作网络详情
- 显示协作网络的详细信息，包括网络ID、昵称等
- 支持查看网络内的设备列表

## 设备管理

### 介绍

设备管理是协作网络下的子资源管理功能，负责管理协作网络内的设备，包括设备的加入、退出、昵称修改和列表查看等操作。每个设备在协作网络中都有唯一的标识和显示名称。

### 属性

- **设备ID**: 设备的唯一标识符，用于在协作网络中区分不同设备
- **设备昵称**: 用户友好的设备名称，用于在协作网络中更直观地识别设备

### 功能

#### 增

##### 设备加入网络
- 通过Access Code加入已存在的协作网络
- 加入后自动同步网络内的设备列表和数据

#### 删

##### 设备退出网络
- 支持设备退出协作网络的操作
- 设备退出网络前，自动检查是否存在绑定了该网络的卡片
- 若存在绑定卡片，弹出确认框进行提示和二次确认
- 二次确认后依旧要退出的，自动解除所有绑定到该网络的卡片的绑定关系

#### 改

##### 修改设备昵称
- 支持为设备设置友好的设备昵称
- 昵称修改限制：每个设备只能修改自己设备的昵称，通过设备ID判断昵称所属
- 设备昵称修改后，在所有协作网络中同步更新

#### 查

##### 设备列表
- 支持查看网络内的设备列表
- 设备列表在网络内实时同步，设备加入或修改昵称时自动更新

## 数据同步机制

### 同步实现
- 使用Yjs的CRDT算法实现多设备间数据同步
- 支持离线操作，上线后自动同步
- 设备间直连同步需要在同一局域网环境下
- 不同网络环境下的设备需要通过信令服务器进行数据同步

### 同步策略
- 优先使用本地数据，确保快速响应
- 后台自动同步，用户无感知
- 支持增量同步，减少网络传输

## 卡片数据绑定机制

### 绑定操作
- 支持在创建或编辑卡片时设置绑定关系
- 支持将已有的未绑定卡片绑定到特定网络

### 默认绑定设置
- 默认行为：新创建的卡片默认绑定到local网络
- 默认设置修改：用户可修改App设置，将默认绑定的协作网络设置为其他网络
- 默认绑定移除：用户可移除默认绑定设置，使新卡片不再默认绑定任何协作网络

## 注意事项

### 网络安全
- Access Code包含敏感连接信息，不应通过不安全的渠道分享

### 数据流转
- 卡片数据绑定到特定网络后，仅能在该网络内流转，需谨慎设置
- 设备退出网络后，所有绑定到该网络的卡片会自动解除绑定关系

### 网络管理
- 设备创建多个协作网络时，需注意网络ID的唯一性和管理
- 设备加入多个网络时，需合理管理设备资源和同步策略

### 网络连接
- 设备间直连同步需要在同一局域网环境下
- 不同网络环境下的设备无法直接同步数据