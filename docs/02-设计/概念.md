# CardMind 概念词典

> 本文档是 CardMind 项目的术语表，提供关键概念的简明定义和说明。详细的需求和设计请参考其他文档。

---

## 1. 业务概念

### 卡片 (Card)

**定义**：CardMind 应用的核心数据单元，用于存储用户的笔记内容。

**核心特性**：
- 每个卡片对应一个独立的 LoroDoc 对象
- 支持动态加入/退出协作空间
- 使用 UUID v7 作为唯一标识

**关联概念**：协作空间、LoroDoc

**参考**：[需求文档 §2.1](../01-需求/需求.md#21-卡片card)

---

### 协作空间 (CollaborationSpace)

**定义**：由多个设备组成的分布式数据同步空间，作为独立的数据池存在。

**核心特性**：
- 设备作为数据池的出入口
- 通过密码保护访问权限
- 所有设备退出后自动消失

**别名**：协作网络、Space

**关联概念**：设备、数据池、LoroDoc、libp2p

**参考**：[需求文档 §2.2](../01-需求/需求.md#22-协作网络collaborationspace)

---

### 设备 (Device)

**定义**：参与协作空间的物理终端，具有唯一的设备指纹标识。

**核心特性**：
- 基于设备指纹生成唯一 ID
- 默认昵称格式：`设备型号-ID前6位`（如：iPhone-abc123）
- 设备信息存储在协作空间的 LoroDoc 中

**关联概念**：设备指纹、协作空间、健康检查

**参考**：[需求文档 §2.3](../01-需求/需求.md#23-设备device)

---

### 常驻网络 (Resident Space)

**定义**：用户设置的默认协作空间，新建卡片将自动加入所有常驻网络。

**用途**：简化卡片的网络管理，自动将新卡片同步到常用空间。

**关联概念**：卡片、协作空间

**参考**：[需求文档 §4.2](../01-需求/需求.md#42-常驻网络机制)

---

## 2. 技术概念

### CRDT

**全称**：Conflict-free Replicated Data Type（无冲突复制数据类型）

**定义**：一种能够在分布式系统中实现无需中央协调的数据同步技术。

**作用**：确保多设备间数据的最终一致性，无需处理冲突解决逻辑。

**实现**：本项目使用 Loro 库作为 CRDT 实现。

---

### Loro

**定义**：基于 Rust 实现的高性能 CRDT 库。

**核心功能**：
- 提供分布式数据无冲突同步能力
- 支持 Subscribe 机制监听数据变化
- 可序列化为二进制格式存储

**关联概念**：CRDT、LoroDoc、Subscribe 机制

**参考**：[需求文档 §3.2.1](../01-需求/需求.md#321-crdt-同步机制)

---

### LoroDoc

**定义**：Loro 库中用于存储和同步数据的核心文档对象。

**核心特性**：
- 每个卡片和协作空间对应一个独立的 LoroDoc
- LoroDoc 的唯一 ID 即为业务对象的 ID
- 可序列化为二进制数据存储在 SQLite 中

**用途**：作为多设备间数据同步的载体，确保数据一致性。

**关联概念**：Loro、卡片、协作空间

---

### libp2p

**定义**：模块化的对等网络（P2P）协议栈。

**核心功能**：
- 设备间的组网与连接管理
- 基于 mDNS 的本地设备发现
- 去中心化设计，无需信令服务器

**作用**：替代传统 WebRTC 和信令服务，实现设备间直接通信。

**关联概念**：P2P、mDNS、服务发现

**参考**：[需求文档 §3.2.2](../01-需求/需求.md#322-p2p-网络拓扑)

---

### UUID v7

**定义**：支持时间排序的分布式唯一标识符生成算法。

**用途**：为卡片和协作空间生成全局唯一 ID，支持分布式环境。

**优势**：相比 UUID v4，具备时间排序特性，更适合数据库索引。

**参考**：[需求文档 §3.1](../01-需求/需求.md#31-技术栈概览)

---

### 读写分离

**定义**：将数据的读操作和写操作分离到不同路径的架构模式。

**实现方式**：
- **写路径**：Flutter → Rust → Loro → Subscribe → SQLite
- **读路径**：Flutter → SQLite（直接查询）

**目标**：提高系统性能和响应速度。

**关联概念**：Subscribe 机制、SQLite

**参考**：[需求文档 §3.2.3](../01-需求/需求.md#323-读写分离架构)

---

### Subscribe 机制

**定义**：Loro 提供的数据变更监听机制。

**作用**：当 LoroDoc 发生变化时，自动触发回调更新 SQLite 表数据。

**用途**：实现读写分离架构中的自动数据同步。

**关联概念**：Loro、LoroDoc、读写分离

---

## 3. 系统概念

### 数据池 (Data Pool)

**定义**：协作空间作为独立数据存储和同步单元的抽象概念。

**特性**：
- 每个协作空间是一个独立的数据池
- 设备作为数据池的出入口
- 数据仅在同一数据池内的设备间同步

**关联概念**：协作空间、设备

**参考**：[需求文档 §1](../01-需求/需求.md#1-产品概述)

---

### 健康检查 (Health Check)

**定义**：用于监测设备在线状态的机制。

**实现方式**：
- SQLite 中维护独立的 `device_health` 表
- 记录设备的最后心跳时间和在线状态

**字段**：`id`、`昵称`、`创建时间`、`更新时间`、`last_heartbeat`、`status`

**用途**：支持 P2P 连接状态管理和设备在线检测。

**关联概念**：设备、P2P 连接

**参考**：[需求文档 §3.4](../01-需求/需求.md#34-数据持久化策略)

---

### 设备指纹 (Device Fingerprint)

**定义**：基于设备硬件和软件特征生成的唯一标识符。

**用途**：为设备生成全局唯一的 ID，确保设备身份的唯一性。

**关联概念**：设备

**参考**：[需求文档 §2.3](../01-需求/需求.md#23-设备device)

---

### 软删除 (Soft Delete)

**定义**：通过标记字段而非物理删除数据的删除策略。

**实现**：卡片模型中的 `删除标记` 字段。

**优势**：支持数据恢复，符合 CRDT 的最终一致性要求。

**关联概念**：卡片

---

## 4. 技术栈简表

| 技术 | 类型 | 用途 |
|------|------|------|
| Flutter | 前端框架 | UI 渲染、权限管理 |
| Rust | 后端语言 | 核心业务逻辑 |
| Loro | CRDT 库 | 数据无冲突同步 |
| libp2p | P2P 协议栈 | 设备组网与通信 |
| SQLite | 嵌入式数据库 | 本地数据持久化 |
| sea-orm | Rust ORM | 数据库访问层 |
| flutter_rust_bridge | 跨语言桥接 | Dart ↔ Rust 通信 |

**参考**：[需求文档 §3.1](../01-需求/需求.md#31-技术栈概览)

---

## 5. 概念关系图

```
┌─────────────────────────────────────────────────────────┐
│                   CardMind 系统                         │
└─────────────────────────────────────────────────────────┘
                           │
        ┌──────────────────┼──────────────────┐
        ▼                  ▼                  ▼
   ┌────────┐        ┌──────────┐       ┌────────┐
   │  卡片   │◄──────►│ 协作空间  │◄─────►│  设备   │
   │ (Card) │        │(ColSpace)│       │(Device)│
   └────────┘        └──────────┘       └────────┘
        │                  │                  │
        │ 1:1              │ 1:1              │
        ▼                  ▼                  │
   ┌─────────┐        ┌─────────┐            │
   │ LoroDoc │        │ LoroDoc │            │
   └─────────┘        └─────────┘            │
        │                  │                  │
        └──────────┬───────┘                  │
                   ▼                          ▼
              ┌─────────┐              ┌──────────────┐
              │ SQLite  │              │ device_health│
              │(查询层) │              │  (健康检查)  │
              └─────────┘              └──────────────┘
                   ▲
                   │ Subscribe 机制
                   │
              ┌────────┐
              │  Loro  │◄──── CRDT 同步
              └────────┘
                   ▲
                   │
              ┌────────┐
              │ libp2p │◄──── P2P 通信
              └────────┘
```

---

## 附录：术语索引

**按字母排序**：

- **C**: Card (卡片)、CollaborationSpace (协作空间)、CRDT
- **D**: Data Pool (数据池)、Device (设备)、Device Fingerprint (设备指纹)
- **H**: Health Check (健康检查)
- **L**: libp2p、Loro、LoroDoc
- **R**: Resident Space (常驻网络)、读写分离
- **S**: Soft Delete (软删除)、Subscribe 机制、SQLite
- **U**: UUID v7
