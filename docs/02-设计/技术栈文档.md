# CardMind 技术栈文档

## 1. 整体架构

### 1.1 前后端架构
- **前端**：Flutter负责UI渲染和网络权限申请
- **后端**：Rust负责核心业务逻辑，包括数据存储、同步、设备组网和通信等
- **通信机制**：前后端通过flutter_rust_bridge进行通信

### 1.2 协同网络架构
- **核心技术**：基于Loro（CRDT协议）和libp2p（P2P网络协议）
  - Loro：实现分布式系统中数据的无冲突同步
  - libp2p：实现设备间的组网、通信和服务发现，替代WebRTC和传统信令服务

## 2. 前端技术栈

| 技术/框架 | 用途 |
|-----------|------|
| Flutter | 跨平台UI框架，负责应用界面渲染 |
| flutter_rust_bridge | 前后端通信桥梁，实现Flutter与Rust的高效通信 |

## 3. 后端技术栈

| 技术/语言 | 用途 |
|-----------|------|
| Rust | 后端开发语言，负责核心业务逻辑 |
| Loro | CRDT库，实现分布式数据无冲突同步 |
| libp2p | P2P网络协议栈，实现设备组网、通信和服务发现 |
| sea-orm | Rust ORM框架，简化SQLite数据库操作 |
| rusqlite | SQLite数据库驱动，用于数据持久化 |

## 4. 数据存储与持久化

| 技术/组件 | 用途 |
|-----------|------|
| SQLite | 本地数据库，用于存储卡片、协作网络和设备信息 |
| UUID v7 | 分布式ID生成算法，用于生成卡片ID、网络ID等核心标识符 |

### 4.1 数据存储设计
- **SQLite表设计**：参考卡片和协作网络属性建表
- **LoroDoc存储**：额外添加字段存储LoroDoc二进制数据

### 4.2 数据处理流程
- **写操作**：Flutter传入写数据请求 → Rust端写入Loro → 通过Loro的subscribe机制自动更新SQLite表数据
- **读操作**：Flutter直接从SQLite表中读取数据
- **设计目标**：实现后端数据的读写分离，提高系统性能和响应速度

## 5. 通信与网络

| 技术/协议 | 用途 |
|-----------|------|
| libp2p | 替代WebRTC和传统信令服务，实现设备间直接通信 |
| flutter_rust_bridge | 前后端进程间通信，实现高效数据传输 |

## 6. 平台支持

| 平台 | 支持情况 |
|------|----------|
| Windows | 未 |
| macOS | 未 |
| Linux | 未 |
| Android | 未 |
| iOS | 未 |

---

**文档版本**：v1.0
**最后更新**：2025-12-21
**适用范围**：CardMind项目开发和维护