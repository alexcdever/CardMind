input: 跨端 UI 交互目标、信息架构与场景流程约束
output: 移动端与桌面端交互设计规格、状态流与测试基线
pos: 跨端 UI 交互设计文档（修改需同步验收矩阵与发布门禁）
# CardMind 移动端与桌面端 UI 交互设计（2026-02-27）

## 1. 设计目标与范围
- 基于现有重启设计与池同步设计，补齐移动端与桌面端页面交互规格。
- 覆盖完整产品流：首次启动、先本地使用、创建/加入池、审批、卡片列表、卡片编辑、设置、退出池。
- 保持离线优先：任何同步异常都不阻断本地卡片读写。
- 首版遵循 YAGNI：不引入多池并行、不引入复杂权限视图。

## 2. 信息架构

### 2.1 移动端（触摸优先）
- 主导航为 3 Tab：`卡片` / `池` / `设置`。
- `卡片` 为默认落点，承载高频操作（浏览、搜索、新建、编辑）。
- 不设置独立首页，概览能力并入 `卡片` 与 `池` 页面。

### 2.2 桌面端（键鼠优先）
- 统一三栏工作台：左栏主导航（卡片/池/设置）+ 中栏列表 + 右栏详情/编辑。
- 与移动端保持同一语义结构，仅在输入方式与效率交互上差异化。

## 3. 页面级交互设计

### 3.1 首次启动/引导
- 首次启动仅提供两个主动作：`先本地使用`、`创建/加入池`。
- `先本地使用` 直接进入卡片页，不增加阻断步骤。
- 桌面支持键盘焦点切换与回车确认默认动作。

### 3.2 卡片页（主工作区）
- 列表默认按最近更新时间排序，支持搜索。
- 关键动作：新建卡片、进入编辑、删除/恢复（按首版能力开放）。
- 空态：引导创建第一张卡片；若存在同步问题，仅显示可处理提示，不阻断主流程。

### 3.3 卡片编辑页
- 内容结构：标题 + Markdown 正文。
- 保存反馈：明确显示“本地已保存”。
- 离开保护：存在未保存改动时，弹出确认（保存并离开/放弃更改/取消）。

### 3.4 池页
- 页面状态：未加入池 / 已加入池 / 异常。
- 未加入：`创建池`、`扫码加入` 入口。
- 已加入：成员列表、我的身份、同步状态、退出池。
- owner 专属动作：编辑池信息、解散池（带确认）。
- 管理员可见审批队列，支持逐条通过/拒绝。

### 3.5 设置页
- 提供基础信息与入口：昵称、设备标识展示、关于与问题排查入口。
- 保留“创建/加入池”可达路径，避免用户锁死在本地模式。

## 4. 跨端输入交互映射

### 4.1 卡片列表
- 移动端：单击进入、长按弹出操作菜单、主按钮新建。
- 桌面端：单击选中、双击打开、右键菜单、方向键移动、`Enter` 打开、`Cmd/Ctrl+N` 新建。

### 4.2 卡片编辑
- 移动端：返回手势触发离开保护；顶部展示保存状态。
- 桌面端：`Cmd/Ctrl+S` 保存、`Esc` 关闭弹层；鼠标优先操作并兼容键盘流。

### 4.3 池流程
- 移动端：扫码加入为主入口，审批采用显式按钮并带二次确认。
- 桌面端：审批列表支持行内快捷处理，强调可见性与批处理效率。

## 5. 状态与数据流

### 5.1 启动与状态探测
- 启动后立即进入本地可用态（卡片可读写）。
- 后台探测池状态：未加入显示未加入态；已加入加载成员与同步状态。

### 5.2 加入池
- 发起加入后进入请求中态，显示可取消/重试。
- 成功后回到池页已加入态，并触发池内相关同步流程。

### 5.3 审批
- 管理员处理后即时反馈；成功从待处理列表移除。
- 失败保留请求项并附错误原因，确保可继续操作。

### 5.4 编辑与同步
- 编辑保存优先落本地；同步异常仅提示“稍后重试”，不阻断编辑。
- 页面内采用“中间态策略”：正常弱提示、异常高亮提示并可跳转处理。

### 5.5 退出池
- 执行前明确提示后果：删除池关联卡片与池元数据，关闭组网。
- 失败时显示“部分清理失败”并提供重试清理动作。

## 6. 错误处理映射（加入池）
- `POOL_NOT_FOUND`：池不存在，提示核对来源并重新获取。
- `INVALID_POOL_HASH`：池标识无效，提示重新扫码。
- `INVALID_KEY_HASH`：校验失败，提示重新发起。
- `ADMIN_OFFLINE`：管理员离线，提示稍后重试。
- `REQUEST_TIMEOUT`：请求超时，提示重试。
- `REJECTED_BY_ADMIN`：申请被拒绝，提示可重新申请。
- `ALREADY_MEMBER`：已是成员，直接切换到已加入态。

## 7. 验收标准（页面交互）
- 首启只有两个入口（先本地使用、创建/加入池），且可直接开始本地写作。
- 移动端三 Tab 架构稳定，卡片高频路径（新建→编辑→保存→返回）无冗余步骤。
- 桌面端键鼠效率链路可用（右键、双击、方向键、快捷键保存）。
- 池相关完整流程可走通（创建、加入、审批、退出）并有清晰状态反馈。
- 七类加入错误码均有可理解文案与下一步动作。
- 同步异常不阻断本地编辑，符合离线优先目标。

## 8. UI 与交互测试基线（强制）
- 每个用户可触发入口（按钮、列表项、菜单项、Banner 动作、快捷键）必须有至少 1 条 Widget 测试覆盖其行为结果。
- 交互测试必须断言可观察结果，而非仅断言组件存在：包括路由跳转、对话框显示、状态文本变化、错误反馈等。
- 关键路径（引导分流、卡片新建到编辑、设置回流池页、同步异常跳转处理）必须保留回归测试。
- 对池流程必须覆盖成功与失败路径（至少 1 条成功 + 1 条错误码失败）。
- 代码库禁止提交空交互实现（如 `onPressed: () {}`、`onTap: () {}`）和未说明原因的禁用交互（如 `onPressed: null`）；由自动化测试守卫。

## 9. 不做项（首版）
- 不做移动端/桌面端功能分叉。
- 不做多池并行视图。
- 不做高级权限体系与复杂同步诊断面板。
