# Dual-Layer Architecture

> **核心概念**: CardMind 采用双层数据架构，确保离线可用与数据一致性的完美平衡。

---

## 1. 工作原理

### 1.1 两层存储

CardMind 在每台设备上维护两层存储：

| 层级 | 作用 | 特点 |
|------|------|------|
| **源数据层** (Loro CRDT) | 记录所有修改 | 离线可写，自动解决冲突 |
| **查询缓存** (SQLite) | 快速读取数据 | 支持搜索和排序 |

### 1.2 数据流向

```
用户操作 → 写入源数据层 → 自动同步到缓存层 → UI 显示
```

**关键特性**：
- 每次修改立即保存到源数据层
- 缓存层自动跟随更新
- 读取时直接查缓存，速度快

---

## 2. 用户体验

### 2.1 离线使用

- 无需网络即可创建、编辑、删除卡片
- 所有操作保存在本地
- 重新联网后自动同步

### 2.2 数据安全

- 源数据层永不丢失（可从文件恢复）
- 缓存层可随时重建（不影响数据）
- 即使缓存损坏，原始数据完整保留

---

## 3. 多设备同步

### 3.1 自动同步

当设备在同一网络时：
- 自动发现其他设备
- 自动交换数据变更
- 无需手动操作

### 3.2 冲突处理

如果同一卡片在多设备上编辑：
- CRDT 自动合并修改
- 最新修改胜出
- 无需用户手动选择

---

## 4. 相关文档

- [产品愿景](../requirements/product_vision.md) - 产品定位
- [用户手册](../user_guide.md) - 完整使用指南
- [同步机制](./sync_mechanism.md) - 同步功能说明

---

**最后更新**: 2026-01-15
