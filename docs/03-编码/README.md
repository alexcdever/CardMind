# ç¼–ç è§„èŒƒæ–‡æ¡£ç´¢å¼•

æœ¬ç›®å½•åŒ…å«CardMindé¡¹ç›®çš„ç¼–ç è§„èŒƒå’Œè®¾è®¡æ–‡æ¡£ã€‚æ‰€æœ‰å¼€å‘è€…åœ¨ç¼–å†™ä»£ç å‰**å¿…é¡»**é˜…è¯»å¹¶éµå®ˆè¿™äº›è§„èŒƒã€‚

## ğŸ“š æ ¸å¿ƒæ–‡æ¡£

### 1. [TDDå¼€å‘è§„èŒƒ.md](./TDDå¼€å‘è§„èŒƒ.md) â­ **å¿…è¯»**
**Test-Driven Development (æµ‹è¯•é©±åŠ¨å¼€å‘) è§„èŒƒ**

è¿™æ˜¯æœ¬é¡¹ç›®**æœ€é‡è¦**çš„å¼€å‘åŸåˆ™æ–‡æ¡£ã€‚æ‰€æœ‰ä»£ç å¿…é¡»éµå¾ªTDDæµç¨‹ï¼š

- ğŸ”´ å…ˆå†™å¤±è´¥çš„æµ‹è¯•ï¼ˆRedï¼‰
- ğŸŸ¢ å†™æœ€å°å®ç°ä½¿å…¶é€šè¿‡ï¼ˆGreenï¼‰
- ğŸ”µ é‡æ„ä¼˜åŒ–ä»£ç ï¼ˆRefactorï¼‰

**å…³é”®è¦æ±‚**ï¼š
- âŒ ç¦æ­¢å…ˆå†™å®ç°å†è¡¥æµ‹è¯•
- âŒ ç¦æ­¢æäº¤æœªæµ‹è¯•çš„ä»£ç 
- âœ… æµ‹è¯•è¦†ç›–ç‡ï¼šService/DAO â‰¥80%ï¼Œå…³é”®ä¸šåŠ¡é€»è¾‘ 100%

**ä½•æ—¶é˜…è¯»**ï¼šå¼€å§‹ä»»ä½•æ–°åŠŸèƒ½å¼€å‘æˆ–Bugä¿®å¤ä¹‹å‰

---

### 2. [æ¶æ„è®¾è®¡æ–‡æ¡£.md](./æ¶æ„è®¾è®¡æ–‡æ¡£.md)
**ç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡**

è¯¦ç»†è¯´æ˜äº†CardMindçš„ä¸‰å±‚æ¶æ„ï¼ˆController/Service/DAOï¼‰ã€æ•°æ®å­˜å‚¨ç­–ç•¥ã€CRDTåŒæ­¥æœºåˆ¶ç­‰ã€‚

**åŒ…å«å†…å®¹**ï¼š
- ä¸‰å±‚æ¶æ„èŒè´£åˆ’åˆ†
- Loro + SQLiteåŒå­˜å‚¨ç­–ç•¥
- ä¾èµ–æ³¨å…¥ï¼ˆAppContainerï¼‰
- Subscribeæœºåˆ¶
- å¸¸é©»ç½‘ç»œä¸šåŠ¡è§„åˆ™

**ä½•æ—¶é˜…è¯»**ï¼š
- åˆšåŠ å…¥é¡¹ç›®ï¼Œéœ€è¦ç†è§£æ•´ä½“æ¶æ„
- è®¾è®¡æ–°åŠŸèƒ½æ¨¡å—
- éœ€è¦ä¿®æ”¹è·¨å±‚äº¤äº’é€»è¾‘

---

### 3. [APIè®¾è®¡ä¸å®ç°è§„èŒƒ.md](./APIè®¾è®¡ä¸å®ç°è§„èŒƒ.md)
**Rust APIçš„è®¾è®¡åŸåˆ™å’Œå®ç°æ¨¡æ¿**

æä¾›äº†Controller/Service/DAOä¸‰å±‚çš„ä»£ç æ¨¡æ¿ã€å‘½åè§„èŒƒã€é”™è¯¯å¤„ç†è§„èŒƒã€‚

**åŒ…å«å†…å®¹**ï¼š
- APIå‘½åè§„èŒƒï¼ˆ`create_`, `get_`, `update_`, `delete_`ï¼‰
- å„å±‚ä»£ç æ¨¡æ¿ï¼ˆå¯ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼‰
- é”™è¯¯ç±»å‹å®šä¹‰å’Œè½¬æ¢
- å®Œæ•´çš„Card CRUDç¤ºä¾‹
- ä»£ç å®¡æŸ¥æ¸…å•

**ä½•æ—¶é˜…è¯»**ï¼š
- å®ç°æ–°çš„APIåŠŸèƒ½
- è¿›è¡Œä»£ç å®¡æŸ¥
- ä¸ç¡®å®šæŸæ®µä»£ç åº”è¯¥æ”¾åœ¨å“ªä¸€å±‚

---

---

## ğŸš€ å¿«é€Ÿå…¥é—¨

### ç¬¬ä¸€æ¬¡è´¡çŒ®ä»£ç ï¼Ÿè¯·æŒ‰é¡ºåºé˜…è¯»ï¼š

1. **[æ¶æ„è®¾è®¡æ–‡æ¡£.md](./æ¶æ„è®¾è®¡æ–‡æ¡£.md)** - ç†è§£ç³»ç»Ÿè®¾è®¡ï¼ˆ30åˆ†é’Ÿï¼‰
2. **[TDDå¼€å‘è§„èŒƒ.md](./TDDå¼€å‘è§„èŒƒ.md)** - å­¦ä¹ TDDæµç¨‹ï¼ˆ45åˆ†é’Ÿï¼‰
3. **[APIè®¾è®¡ä¸å®ç°è§„èŒƒ.md](./APIè®¾è®¡ä¸å®ç°è§„èŒƒ.md)** - æŒæ¡ç¼–ç è§„èŒƒï¼ˆ30åˆ†é’Ÿï¼‰
4. è¿è¡Œç°æœ‰æµ‹è¯•ï¼Œç†Ÿæ‚‰æµ‹è¯•é£æ ¼ï¼š
   ```bash
   cd rust
   cargo test
   cargo test --test three_layer_integration_test
   ```

### å¼€å§‹æ–°åŠŸèƒ½å¼€å‘çš„checklistï¼š

- [ ] é˜…è¯»ç›¸å…³éœ€æ±‚æ–‡æ¡£ï¼ˆ`docs/01-éœ€æ±‚/`ï¼‰
- [ ] æŸ¥çœ‹[æ¶æ„è®¾è®¡æ–‡æ¡£.md](./æ¶æ„è®¾è®¡æ–‡æ¡£.md)ç¡®è®¤åŠŸèƒ½åº”è¯¥æ”¾åœ¨å“ªä¸€å±‚
- [ ] æ‰“å¼€[TDDå¼€å‘è§„èŒƒ.md](./TDDå¼€å‘è§„èŒƒ.md)ï¼ŒæŒ‰ç…§TDDæµç¨‹å¼€å‘
- [ ] å‚è€ƒ[APIè®¾è®¡ä¸å®ç°è§„èŒƒ.md](./APIè®¾è®¡ä¸å®ç°è§„èŒƒ.md)çš„ä»£ç æ¨¡æ¿
- [ ] å¼€å‘è¿‡ç¨‹ï¼šå…ˆå†™æµ‹è¯• â†’ æœ€å°å®ç° â†’ é‡æ„
- [ ] æäº¤å‰è¿è¡Œ `cargo test` å’Œ `cargo tarpaulin`
- [ ] æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡æ˜¯å¦è¾¾æ ‡ï¼ˆâ‰¥80%ï¼‰

---

## ğŸ“– æ–‡æ¡£é—´çš„å…³ç³»

```
æ¶æ„è®¾è®¡æ–‡æ¡£.md
    â†“ å®šä¹‰äº†ç³»ç»Ÿæ•´ä½“æ¶æ„å’Œè®¾è®¡åŸåˆ™
APIè®¾è®¡ä¸å®ç°è§„èŒƒ.md
    â†“ ç»†åŒ–äº†å…·ä½“çš„ç¼–ç è§„èŒƒå’Œæ¨¡æ¿
TDDå¼€å‘è§„èŒƒ.md
    â†“ è§„å®šäº†å¼€å‘æµç¨‹å’Œæµ‹è¯•è¦æ±‚
```

**ç®€å•æ¥è¯´**ï¼š
- æƒ³äº†è§£"ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡" â†’ è¯»æ¶æ„è®¾è®¡æ–‡æ¡£
- æƒ³çŸ¥é“"æ€ä¹ˆå†™ä»£ç " â†’ è¯»APIè®¾è®¡ä¸å®ç°è§„èŒƒ
- æƒ³æŒæ¡"å¼€å‘æµç¨‹" â†’ è¯»TDDå¼€å‘è§„èŒƒ

---

## âš ï¸ é‡è¦æé†’

### å¼ºåˆ¶æ€§è¦æ±‚

1. **TDDæ˜¯å¼ºåˆ¶æ€§çš„**
   - æ‰€æœ‰æ–°åŠŸèƒ½å¿…é¡»å…ˆå†™æµ‹è¯•
   - æ‰€æœ‰Bugä¿®å¤å¿…é¡»å…ˆå†™å¤ç°æµ‹è¯•
   - æµ‹è¯•è¦†ç›–ç‡ä½äº80%çš„PRå°†è¢«æ‹’ç»

2. **ä¸‰å±‚æ¶æ„æ˜¯å¼ºåˆ¶æ€§çš„**
   - Controlleråªåšå‚æ•°éªŒè¯å’Œé”™è¯¯è½¬æ¢
   - Serviceå®ç°æ‰€æœ‰ä¸šåŠ¡é€»è¾‘
   - DAOåªåšæ•°æ®æŒä¹…åŒ–
   - è¿ååˆ†å±‚åŸåˆ™çš„ä»£ç å°†è¢«è¦æ±‚é‡æ„

3. **ä¾èµ–æ³¨å…¥æ˜¯å¼ºåˆ¶æ€§çš„**
   - æ‰€æœ‰Serviceå¿…é¡»é€šè¿‡AppContainerè·å–
   - ç¦æ­¢åœ¨ä»£ç ä¸­æ‰‹åŠ¨newæœåŠ¡å®ä¾‹
   - è¿åDIåŸåˆ™çš„ä»£ç å°†è¢«æ‹’ç»

### å¸¸è§æ–°äººé”™è¯¯

âŒ **é”™è¯¯1**ï¼šå…ˆå†™å®Œæ•´å®ç°ï¼Œå†è¡¥æµ‹è¯•
```rust
// é”™è¯¯ç¤ºä¾‹ï¼šå†™äº†100è¡Œä»£ç ï¼Œç„¶åå†™ä¸€ä¸ªç®€å•æµ‹è¯•
pub async fn create_card(...) { /* 100è¡Œä»£ç  */ }

#[test]
fn test_create_card() { /* ç®€å•æµ‹è¯• */ }
```

âœ… **æ­£ç¡®åšæ³•**ï¼šå°æ­¥è¿­ä»£ï¼Œæµ‹è¯•å…ˆè¡Œ
```rust
// 1. å…ˆå†™æµ‹è¯•
#[test]
fn test_create_card_should_generate_uuid() { }

// 2. æœ€å°å®ç°
pub async fn create_card(...) {
    let id = Uuid::now_v7();
    // ...
}

// 3. ç»§ç»­æ·»åŠ ä¸‹ä¸€ä¸ªæµ‹è¯•...
```

---

âŒ **é”™è¯¯2**ï¼šåœ¨DAOå±‚å†™ä¸šåŠ¡é€»è¾‘
```rust
// é”™è¯¯ï¼šsoft_deleteæ˜¯ä¸šåŠ¡é€»è¾‘ï¼Œä¸åº”è¯¥åœ¨DAO
impl CardDao {
    pub async fn soft_delete(&self, id: Uuid) -> Result<()> {
        // é”™è¯¯ä½ç½®
    }
}
```

âœ… **æ­£ç¡®åšæ³•**ï¼šä¸šåŠ¡é€»è¾‘åœ¨Serviceå±‚
```rust
// DAOåªæä¾›åŸºæœ¬CRUD
impl CardDao {
    pub async fn update(&self, card: Card) -> Result<()> { }
}

// Serviceå®ç°ä¸šåŠ¡é€»è¾‘
impl CardService {
    pub async fn soft_delete_card(&self, id: Uuid) -> Result<()> {
        let mut card = self.dao.find_by_id(id).await?;
        card.is_deleted = true;
        self.dao.update(card).await?;
        Ok(())
    }
}
```

---

âŒ **é”™è¯¯3**ï¼šæµ‹è¯•é—´ç›¸äº’ä¾èµ–
```rust
// é”™è¯¯ï¼štest2ä¾èµ–test1çš„æ•°æ®
#[test]
fn test1_create_card() { /* åˆ›å»ºIDä¸º"test-card" */ }

#[test]
fn test2_update_card() { /* å‡è®¾"test-card"å­˜åœ¨ */ }
```

âœ… **æ­£ç¡®åšæ³•**ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹
```rust
#[test]
fn test1_create_card() {
    let db = setup_test_db(); // ç‹¬ç«‹ç¯å¢ƒ
    // ...
}

#[test]
fn test2_update_card() {
    let db = setup_test_db(); // ç‹¬ç«‹ç¯å¢ƒ
    let card = create_test_card(); // æµ‹è¯•å†…åˆ›å»ºä¾èµ–
    // ...
}
```

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

- ä¸ç¡®å®šä»£ç åº”è¯¥æ”¾åœ¨å“ªä¸€å±‚ï¼Ÿâ†’ æŸ¥çœ‹[æ¶æ„è®¾è®¡æ–‡æ¡£.md](./æ¶æ„è®¾è®¡æ–‡æ¡£.md)ç¬¬3èŠ‚
- ä¸çŸ¥é“å¦‚ä½•å†™æµ‹è¯•ï¼Ÿâ†’ æŸ¥çœ‹[TDDå¼€å‘è§„èŒƒ.md](./TDDå¼€å‘è§„èŒƒ.md)ç¬¬3èŠ‚çš„å®Œæ•´ç¤ºä¾‹
- APIå‘½åä¸ç¡®å®šï¼Ÿâ†’ æŸ¥çœ‹[APIè®¾è®¡ä¸å®ç°è§„èŒƒ.md](./APIè®¾è®¡ä¸å®ç°è§„èŒƒ.md)ç¬¬2èŠ‚
- æƒ³äº†è§£å¼€å‘æµç¨‹ï¼Ÿâ†’ æŸ¥çœ‹[TDDå¼€å‘è§„èŒƒ.md](./TDDå¼€å‘è§„èŒƒ.md)ç¬¬2èŠ‚

---

## ğŸ“ æ–‡æ¡£ç»´æŠ¤

è¿™äº›æ–‡æ¡£æ˜¯æ´»æ–‡æ¡£ï¼Œä¼šéšç€é¡¹ç›®æ¼”è¿›è€Œæ›´æ–°ï¼š

- å‘ç°æ–‡æ¡£ä¸ä»£ç ä¸ä¸€è‡´ï¼Ÿè¯·æIssueæˆ–PR
- æœ‰æ›´å¥½çš„å®è·µå»ºè®®ï¼Ÿæ¬¢è¿è®¨è®ºå’Œæ”¹è¿›
- æ–‡æ¡£ä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Ÿè¯·æå‡ºæ¥ï¼Œæˆ‘ä»¬ä¼šè¡¥å……è¯´æ˜

**æœ€åæ›´æ–°**: 2025-12-25
