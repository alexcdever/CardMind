# CardMind 测试文档

## 1. 测试概述

本文档用于验证CardMind项目的核心功能，包括局域网环境下的多设备点对点互联、数据同步和设备发现功能。

## 2. 测试环境要求

### 网络环境
- **同一局域网**: 所有测试设备必须连接到同一个WiFi或有线网络
- **无VPN**: 关闭所有VPN连接
- **防火墙配置**: 允许WebRTC流量（UDP端口3478-3497，TCP端口80/443）
- **IP连通性**: 设备间可以互相ping通

### 设备要求
- **最少2台设备**: 用于测试点对点连接
- **推荐3-4台设备**: 测试多点对多点组网
- **现代浏览器**: Chrome 80+, Firefox 75+, Safari 13+
- **支持WebRTC**: 所有设备必须支持WebRTC API

## 3. 测试准备

### 启动多个实例

#### 不同端口启动（推荐）
```bash
# 设备A - 主机（端口3000）
pnpm dev --port 3000

# 设备B - 客户端1（端口3001）  
pnpm dev --port 3001

# 设备C - 客户端2（端口3002）
pnpm dev --port 3002
```

### 网络连通性检查
```bash
# 在每台设备上执行，确保能ping通其他设备
ping 192.168.1.100  # 设备A的IP
ping 192.168.1.101  # 设备B的IP
```

## 4. 核心测试用例

### 测试1: 基础连接测试

#### 步骤
1. **创建网络（主机）**
   - 在设备A上打开应用：`http://localhost:3000`
   - 点击右上角"网络"图标
   - 选择"创建网络"
   - 复制生成的访问码

2. **加入网络（客户端）**
   - 在设备B上打开应用：`http://localhost:3001`
   - 点击右上角"网络"图标
   - 选择"加入网络"
   - 粘贴访问码并点击"加入网络"

3. **验证连接**
   - 观察网络状态图标（绿色：已连接，黄色：连接中，红色：未连接）
   - 查看设备列表，确认所有在线设备都能显示

#### 预期结果
- WebRTC状态: ✅ 已连接
- 设备列表: 显示所有在线设备
- 连接状态: 绿色已连接图标

### 测试2: 数据同步测试

#### 步骤
1. **创建测试卡片**
   - 在设备A上创建一张新卡片
   - 填写标题和内容
   - 保存卡片

2. **验证自动同步**
   - 在其他设备上观察卡片列表
   - 新卡片应该自动出现
   - 检查卡片内容是否完全一致

3. **编辑冲突测试**
   - 同时在两台设备上编辑同一张卡片
   - 保存修改
   - 观察冲突解决机制

4. **删除同步测试**
   - 在一台设备上删除卡片
   - 验证其他设备上卡片被删除

#### 预期结果
- 卡片创建: ✅ 自动同步到所有设备
- 卡片编辑: ✅ 内容一致，冲突正确处理
- 卡片删除: ✅ 同步删除操作
- 同步延迟: < 2秒

### 测试3: 网络状态监控测试

#### 步骤
1. **使用内置监控组件**
   - 在主界面右下角找到网络状态监控组件
   - 观察实时连接状态

2. **断开重连测试**
   - 关闭一台设备的浏览器
   - 观察其他设备的连接状态变化
   - 重新打开浏览器
   - 验证自动重连

#### 预期结果
- 状态显示: ✅ 实时更新
- 断线重连: ✅ 自动恢复

### 测试4: 边界条件测试

#### 步骤
1. **网络中断测试**
   - 断开一台设备的网络连接
   - 观察其他设备的反应
   - 重新连接网络
   - 验证数据同步恢复

2. **浏览器刷新测试**
   - 在一台设备上刷新浏览器
   - 验证重新加入网络
   - 检查数据完整性

#### 预期结果
- 网络中断: ✅ 优雅处理，重连后恢复
- 浏览器刷新: ✅ 自动重连

## 5. 测试验证清单

### ✅ 连接验证
- [ ] 所有设备成功加入网络
- [ ] WebRTC连接状态显示"已连接"
- [ ] 设备间可以互相发现

### ✅ 数据同步验证
- [ ] 卡片创建自动同步
- [ ] 卡片编辑实时更新
- [ ] 卡片删除同步执行
- [ ] 同步延迟在可接受范围内

### ✅ 稳定性验证
- [ ] 断线重连功能正常
- [ ] 浏览器刷新后自动恢复
- [ ] 网络中断处理优雅

## 6. 故障排除

### 常见问题1: 设备无法发现
**症状**: 加入网络后看不到其他设备
**解决方案**:
1. 检查所有设备是否在同一局域网
2. 确认防火墙未阻止WebRTC端口
3. 尝试刷新页面重新加入
4. 检查浏览器控制台错误信息

### 常见问题2: 数据同步失败
**症状**: 卡片创建后未同步到其他设备
**解决方案**:
1. 验证WebRTC连接状态
2. 检查IndexedDB是否正常工作
3. 查看同步服务日志
4. 尝试手动触发同步

### 常见问题3: 连接不稳定
**症状**: 连接频繁断开
**解决方案**:
1. 检查网络信号强度
2. 降低设备间距离
3. 重启路由器
4. 使用有线连接替代WiFi

## 7. 性能指标

### 连接性能
- **连接建立时间**: < 5秒
- **设备发现时间**: < 3秒
- **重连恢复时间**: < 10秒

### 同步性能
- **数据同步延迟**: < 2秒
- **批量数据同步**: < 5秒（100张卡片）
- **冲突解决时间**: < 1秒

### 资源使用
- **内存占用**: < 100MB
- **CPU使用率**: < 10%
- **网络带宽**: < 1Mbps

## 8. 测试完成标准

测试完成需要满足以下条件：
1. ✅ 所有基础连接测试通过
2. ✅ 数据同步功能正常工作
3. ✅ 网络状态监控准确
4. ✅ 边界条件处理正确
5. ✅ 性能指标达到要求