# 双语规格编写指南

**版本**：1.0.0
**最后更新**：2026-01-23

---

## 目的

本指南定义了 CardMind 项目中编写双语（英中）规格的标准格式。

**为什么使用双语？**
- **英语**：确保精确的技术术语（SHALL、MUST、GIVEN、WHEN、THEN），AI 工具能正确理解
- **中文**：开发者的母语，促进更快的理解和协作

---

## 标准格式

### 1. 文档结构

每个规格必须遵循以下结构：

```markdown
# [功能名称] 规格

**元数据部分**（版本、状态、依赖、测试）

**概述**（简要描述）

**需求**（多个需求部分）

**测试覆盖**（测试文件、测试用例、验收标准）

**相关文档**（ADR、相关规格）
```

### 2. 元数据部分

```markdown
**版本**：X.Y.Z
**状态**：草稿 | 生效中 | 已废弃
**依赖**：[spec.md](path/to/spec.md)
**相关测试**：`path/to/test.rs`
```

**规则**：
- 使用 Markdown 链接表示依赖
- 使用相对路径
- 状态必须是：草稿、生效中、已废弃 之一

### 3. 需求部分

每个需求遵循此模式：

```markdown
## 需求：中文标题

中文陈述（使用"应"）

### 场景：场景中文标题

- **前置条件**：中文前置条件
- **操作**：中文操作
- **预期结果**：中文预期结果
- **并且**：附加结果
```

### 4. 关键关键字

**需求关键字**：
- SHALL / 应 - 强制性需求
- SHOULD / 宜 - 推荐但非强制
- MAY / 可 - 可选
- MUST NOT / 禁止 - 禁止

**场景关键字**：
- GIVEN / 前置条件 - 前置条件
- WHEN / 操作 - 操作或触发
- THEN / 预期结果 - 预期结果
- AND / 并且 - 附加条件或结果

---

## 模板

### 完整模板

完整模板请参见 [spec_template.md](spec_template.md)。

### 示例规格

完整示例请参见 [spec_example.md](spec_example.md)。

---

## 最佳实践

### 1. 中文在前，英文紧随

```markdown
✅ 正确：
## 需求：数据同步

❌ 错误：
## Requirement: Data Synchronization
```

**为什么？** 本项目主要使用中文，中文在前更符合阅读习惯。

### 2. 一致的术语

在整个文档中对英语技术术语使用相同的中文翻译：

| English | 中文 | 说明 |
|---------|------|------|
| Pool | 池 | 不使用"池子"或"存储池" |
| Device | 设备 | 不使用"装置" |
| Card | 卡片 | 不使用"卡" |
| Sync | 同步 | 不使用"同步化" |
| Joined Pool | 已加入池 | 不使用"加入的池" |

### 3. SHALL 陈述

**模式**：
```markdown
系统应[动词][对象][条件]。
```

**示例**：
```markdown
✅ 系统应拒绝重复的卡片 ID。

✅ 设备离开池时应清除本地数据。
```

### 4. 场景结构

保持场景原子化和可测试性：

```markdown
✅ 正确：
### 场景：使用有效标题创建卡片
- **前置条件**：用户有权限创建卡片
- **操作**：用户创建标题为"My Note"的卡片
- **预期结果**：卡片应成功创建

❌ 错误：
### 场景：卡片管理
- **前置条件**：用户已登录
- **操作**：用户执行各种卡片操作
- **预期结果**：所有操作都正常工作
```

### 5. 测试映射

将场景链接到实际测试用例：

```markdown
## 测试覆盖

**单元测试**：
- `it_should_create_card_with_valid_title()` - 映射到场景"使用有效标题创建卡片"
```

---

## 验证清单

提交规格前，请验证：

- [ ] 所有部分都是中文
- [ ] SHALL/SHOULD/MAY 关键字使用正确
- [ ] 所有场景遵循 前置条件-操作-预期结果 结构
- [ ] 依赖使用 Markdown 链接
- [ ] 测试用例已列出并映射到场景
- [ ] 中文翻译准确且一致

---

## 工具

**模板文件**：`openspec/specs/spec_template.md`
**示例文件**：`openspec/specs/spec_example.md`
**验证工具**：`tool/verify_spec_sync.dart`

---

**有疑问？** 参考 `openspec/specs/domain/` 中现有的规格作为示例。

---

**最后更新**：2026-01-23
**维护者**：CardMind Team
