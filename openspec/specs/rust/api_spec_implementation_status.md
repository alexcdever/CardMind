# SP-API-005 å®æ–½çŠ¶æ€æŠ¥å‘Š

## ğŸ“‹ è§„æ ¼ç¼–å·: SP-API-005-IMPL
**ç‰ˆæœ¬**: 1.0.0
**çŠ¶æ€**: å®æ–½æŠ¥å‘Š
**å…³è”è§„æ ¼**: specs/rust/api_spec.md

> æ—¥æœŸ: 2026-01-14
> è§„æ ¼: `specs/rust/api_spec.md`

## âœ… å®æ–½çŠ¶æ€æ€»è§ˆ

| æ¨¡å— | APIå‡½æ•° | çŠ¶æ€ | è¯´æ˜ |
|------|--------|------|------|
| **Card** | `init_card_store` | âœ… å·²å®ç° | å…¨å±€CardStoreåˆå§‹åŒ– |
| | `create_card` | âœ… å·²å®ç° | åˆ›å»ºå¡ç‰‡ |
| | `get_all_cards` | âœ… å·²å®ç° | è·å–æ‰€æœ‰å¡ç‰‡ |
| | `get_active_cards` | âœ… å·²å®ç° | è·å–æ´»è·ƒå¡ç‰‡ |
| | `get_card_by_id` | âœ… å·²å®ç° | æŒ‰IDæŸ¥è¯¢å¡ç‰‡ |
| | `update_card` | âœ… å·²å®ç° | æ›´æ–°å¡ç‰‡ |
| | `delete_card` | âœ… å·²å®ç° | åˆ é™¤å¡ç‰‡ï¼ˆè½¯åˆ é™¤ï¼‰|
| **DeviceConfig** | `init_device_config` | âœ… å·²å®ç° | åˆå§‹åŒ–é…ç½® |
| | `get_device_config` | âœ… å·²å®ç° | è·å–é…ç½® |
| | `get_device_id` | âœ… å·²å®ç° | è·å–è®¾å¤‡ID |
| | `join_pool` | âœ… å·²å®ç° | åŠ å…¥æ±  |
| | `leave_pool` | âœ… å·²å®ç° | ç¦»å¼€æ±  |
| | `set_resident_pool` | âœ… å·²å®ç° | è®¾ç½®å¸¸é©»æ± ï¼ˆå•æ± æ¨¡å‹è¿”å›é”™è¯¯ï¼‰|
| | `get_joined_pools` | âœ… å·²å®ç° | è·å–å·²åŠ å…¥æ±  |
| | `get_resident_pools` | âœ… å·²å®ç° | è·å–å¸¸é©»æ±  |
| | `is_pool_joined` | âœ… å·²å®ç° | æ£€æŸ¥æ˜¯å¦åŠ å…¥æ±  |
| | `is_pool_resident` | âœ… å·²å®ç° | æ£€æŸ¥æ˜¯å¦å¸¸é©»æ±  |
| **Sync** | `init_sync_service` | âœ… å·²å®ç° | åˆå§‹åŒ–åŒæ­¥æœåŠ¡ |
| | `sync_pool` | âœ… å·²å®ç° | æ‰‹åŠ¨åŒæ­¥æ±  |
| | `get_sync_status` | âœ… å·²å®ç° | è·å–åŒæ­¥çŠ¶æ€ |
| | `get_local_peer_id` | âœ… å·²å®ç° | è·å–æœ¬åœ°Peer ID |
| | `cleanup_sync_service` | âœ… å·²å®ç° | æ¸…ç†åŒæ­¥æœåŠ¡ |

---

## ğŸ” è§„èŒƒç¬¦åˆæ€§æ£€æŸ¥

### âœ… å‘½åè§„èŒƒ
- æ‰€æœ‰å‡½æ•°ä½¿ç”¨ `snake_case` å‘½å
- ç¬¦åˆRustå‘½åæƒ¯ä¾‹

### âœ… é”™è¯¯å¤„ç†
- æ‰€æœ‰APIè¿”å› `Result<T, CardMindError>` ç±»å‹
- é”™è¯¯ä½¿ç”¨ `?` æ“ä½œç¬¦ä¼ æ’­
- ç»Ÿä¸€çš„é”™è¯¯ç±»å‹

### âœ… åˆå§‹åŒ–æ¨¡å¼
- CardStoreä½¿ç”¨å…¨å±€Mutexä¿æŠ¤
- DeviceConfigä½¿ç”¨thread-localå­˜å‚¨
- SyncServiceä½¿ç”¨thread-localå­˜å‚¨

### âœ… Flutteræ¡¥æ¥
- æ‰€æœ‰å‡½æ•°æ ‡è®°ä¸º `#[flutter_rust_bridge::frb]`
- åŒæ­¥å‡½æ•°ä½¿ç”¨é»˜è®¤è¡Œä¸º

---

## ğŸ“ è¡¥å……è¯´æ˜

### å•æ± æ¨¡å‹é€‚é…
- `set_resident_pool` è¿”å›é”™è¯¯ï¼ˆå•æ± æ¨¡å‹ä¸æ”¯æŒï¼‰
- `get_resigned_pools` è¿”å›ç©ºåˆ—è¡¨
- `join_pool` åªèƒ½åŠ å…¥ä¸€ä¸ªæ± 

### çº¿ç¨‹å®‰å…¨
- CardStore: `Arc<Mutex<CardStore>>` å…¨å±€å•ä¾‹
- DeviceConfig: thread-localå­˜å‚¨
- SyncService: thread-localå­˜å‚¨

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. **è¡¥å……å•å…ƒæµ‹è¯•** (ä¼˜å…ˆçº§: é«˜)
   - ä¸ºæ¯ä¸ªAPIç¼–å†™ `it_should_xxx` é£æ ¼çš„æµ‹è¯•
   - æµ‹è¯•è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯åœºæ™¯

2. **é›†æˆæµ‹è¯•** (ä¼˜å…ˆçº§: ä¸­)
   - æµ‹è¯•APIä¹‹é—´çš„äº¤äº’
   - æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·æµç¨‹

3. **APIæ–‡æ¡£æ”¹è¿›** (ä¼˜å…ˆçº§: ä½)
   - æ·»åŠ æ›´å¤šDartç¤ºä¾‹ä»£ç 
   - è¡¥å……é”™è¯¯åœºæ™¯è¯´æ˜

---

## ğŸ“Š ç»Ÿè®¡

- **æ€»APIæ•°é‡**: 22
- **å·²å®ç°**: 22 (100%)
- **ç¬¦åˆè§„èŒƒ**: 22 (100%)
- **å¾…æµ‹è¯•**: 0 (éœ€è¡¥å……å•å…ƒæµ‹è¯•)
