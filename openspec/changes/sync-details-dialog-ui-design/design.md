## Context

CardMind 已经实现了基础的同步状态指示器，但缺少详细的同步信息展示。当用户点击同步状态指示器时，需要一个专门的对话框来显示详细的同步状态、设备信息、统计数据和历史记录。

原始设计文档详细定义了桌面端同步详情对话框的功能需求，包括实时状态更新、设备列表展示、统计信息显示、同步历史记录，以及完整的交互设计和边界情况处理。

## Goals / Non-Goals

**Goals:**
- 提供桌面端专用的同步详情对话框
- 实现实时同步状态和设备列表更新
- 显示详细的同步统计信息
- 提供完整的同步历史记录（最多 20 条）
- 实现优雅的对话框动画和交互
- 处理各种错误状态和边界情况

**Non-Goals:**
- 不提供任何操作功能（纯信息展示）
- 不在移动端显示（仅桌面端）
- 不修改现有的同步引擎逻辑

## Decisions

### 1. 桌面端专用设计
**决策**: 同步详情对话框仅在桌面端显示
**理由**: 
- 桌面端有足够的屏幕空间显示详细信息
- 移动端可以通过设备管理页面查看同步信息
- 避免移动端屏幕过于拥挤
- 符合平台特定的用户体验

### 2. 实时状态更新机制
**决策**: 使用 Stream 订阅实现实时状态更新
**理由**:
- 用户期望看到最新的状态信息
- 避免手动刷新操作
- 技术上更加高效（相比轮询）
- 提供更好的用户体验

### 3. 信息展示优先级设计
**决策**: 按重要性组织信息展示
**理由**:
- 状态信息最关键（顶部大区域）
- 设备列表次重要（左侧大区域）
- 统计信息参考性（右侧中等区域）
- 历史记录补充性（底部动态区域）

### 4. 历史记录数量限制
**决策**: 只显示最近 20 条同步历史记录
**理由**:
- 性能考虑：减少数据传输和渲染开销
- 用户关注：用户更关心最近的同步记录
- 存储优化：避免无限增长的数据存储
- 界面简洁：避免信息过载

### 5. 错误处理优先显示
**决策**: 优先显示错误状态信息
**理由**:
- 用户需要快速了解问题所在
- 提供明确的错误指导
- 避免正常状态被误认为错误
- 符合用户的错误心理预期

## Risks / Trade-offs

### 性能风险: 实时更新频率过高
**风险**: 频繁的实时更新可能影响性能
**缓解**:
- 合理的更新频率控制
- 使用防抖机制避免过度更新
- 优化数据结构减少传输开销
- 仅在真正状态变化时触发更新

### 复杂性风险: 对话框组件过于复杂
**风险**: 组件层次过深可能导致维护困难
**缓解**:
- 清晰的组件分层和职责分离
- 详细的文档和类型定义
- 合理的默认值和错误处理
- 渐进式功能添加

### 数据风险: 历史记录存储无限增长
**风险**: 同步历史记录可能无限增长影响性能
**缓解**:
- 固定显示数量限制（20 条）
- 自动清理过期记录
- 分页或归档机制（未来扩展）
- 数据库查询优化

### 兼容性风险: 多设备状态同步
**风险**: 不同设备可能显示不同的状态信息
**缓解**:
- 统一的状态获取接口
- 明确的状态优先级规则
- 设备时间同步和校验机制
- 清晰的错误状态定义

## Migration Plan

### Phase 1: 基础数据模型和状态
1. 实现 SyncState、SyncStatistics、SyncHistoryEntry 数据模型
2. 创建设备管理和类型定义
3. 添加时间格式化和数据大小转换工具
4. 实现基础的 Riverpod 状态管理

### Phase 2: 核心对话框组件
1. 创建 SyncDetailsDialog 主组件结构
2. 实现 SyncStatusSection 状态显示区域
3. 添加 DeviceListSection 设备列表组件
4. 创建 SyncStatisticsSection 统计信息组件
5. 实现 SyncHistorySection 历史记录组件

### Phase 3: 实时更新和 Stream 集成
1. 实现 Stream 订阅管理
2. 添加同步状态实时更新
3. 实现设备列表动态更新
4. 添加同步历史自动添加机制
5. 优化更新频率和防抖处理

### Phase 4: Rust 端接口集成
1. 添加 Rust FFI 接口定义
2. 实现同步状态 Stream 接口
3. 添加设备列表 Stream 接口
4. 实现同步统计和历史查询接口

### Phase 5: 交互和动画优化
1. 实现对话框打开/关闭动画
2. 添加悬停效果和过渡动画
3. 优化滚动性能和内存使用
4. 实现键盘快捷键支持

## Open Questions

1. **状态同步**: 如何确保不同设备显示的同步状态一致？
2. **性能基准**: 对话框打开和状态更新的性能目标是什么？
3. **历史扩展**: 未来是否需要支持历史记录的搜索和过滤？
4. **错误恢复**: 是否需要提供错误恢复和重试机制？
5. **多语言**: 同步状态的文本信息如何支持国际化？