## Context

CardMind 已经实现了基础的同步和数据管理功能，但缺少统一的设置界面。用户需要一个集中的地方来管理应用的各种配置，包括通知设置、外观主题、数据导入导出和查看应用信息。

原始设计文档详细定义了设置面板的功能需求，包括平台特定的界面设计、数据管理操作、即时生效的开关设置，以及完整的应用信息展示。

## Goals / Non-Goals

**Goals:**
- 提供统一的应用设置管理界面
- 实现平台特定的交互设计（移动端全屏，桌面端对话框）
- 支持即时生效的开关设置（如通知、深色模式）
- 实现安全的数据导入导出功能（Loro 格式）
- 提供详细的应用信息和更新日志
- 确保设置持久化和状态管理

**Non-Goals:**
- 不提供清空所有数据的功能（安全考虑）
- 不支持其他数据格式（仅支持 Loro 格式）
- 不修改现有的同步引擎和核心业务逻辑

## Decisions

### 1. 平台特定的界面设计
**决策**: 移动端使用全屏页面，桌面端使用弹出对话框
**理由**: 
- 符合各平台的设计规范和用户习惯
- 移动端屏幕较小，全屏更适合设置浏览
- 桌面端支持快捷键和快速打开/关闭操作
- 对话框形式便于在桌面端快速访问

### 2. 即时生效的开关设置
**决策**: 通知和深色模式等设置立即生效，无需确认按钮
**理由**:
- 用户期望：开关设置应该立即生效
- 用户体验：避免额外的确认步骤
- 技术简化：减少状态管理和复杂度
- 符合现代应用的设计趋势

### 3. Loro 格式的数据导入导出
**决策**: 仅支持 Loro 二进制格式的数据文件
**理由**:
- 完整性：保留完整的 CRDT 历史和元数据
- 一致性：导出和导入使用相同格式
- 性能：二进制格式比文本格式更高效
- 安全性：Loro 是经过验证的 CRDT 格式

### 4. 合并而非覆盖的数据导入策略
**决策**: 导入数据时合并到现有数据，不覆盖
**理由**:
- 安全性：避免意外覆盖用户现有数据
- CRDT 特性：Loro 天然支持数据合并
- 用户期望：大多数应用的导入功能都是合并
- 灵活性：可以从多个备份文件逐步导入

### 5. 限制更新日志显示数量
**决策**: 关于应用中只显示最近 3 个版本的更新日志
**理由**:
- 简洁性：避免信息过载和界面混乱
- 性能：减少渲染内容
- 空间考虑：移动端屏幕空间有限
- 完整性：用户可以通过 GitHub 查看完整历史

### 6. 文件大小限制为 100MB
**决策**: 导入文件大小限制为 100MB
**理由**:
- 性能：大文件解析消耗大量内存和时间
- 实际需求：正常使用不会超过 100MB（1000张卡片远小于此）
- 用户体验：避免长时间等待和应用无响应
- 安全性：防止恶意文件攻击或内存溢出

## Risks / Trade-offs

### 安全风险: 数据丢失
**风险**: 导入导出操作可能导致数据丢失
**缓解**:
- 导入时采用合并策略，不覆盖现有数据
- 提供确认对话框和操作预览
- 支持撤销操作（如果技术允许）
- 详细的错误提示和恢复指导

### 复杂性风险: 设置管理过于复杂
**风险**: 设置项过多可能导致界面复杂和难以维护
**缓解**:
- 清晰的设置分组和层次结构
- 合理的默认值和自动检测
- 直观的图标和说明文字
- 渐进式功能添加

### 兼容性风险: Loro 格式版本兼容性
**风险**: 不同版本的 Loro 格式可能不兼容
**缓解**:
- 版本检查和兼容性验证
- 优雅的错误处理和降级
- 清晰的错误提示和解决建议
- 向后兼容性设计

### 性能风险: 大文件处理
**风险**: 导入导出大文件可能影响性能
**缓解**:
- 文件大小限制（100MB）
- 进度指示器和异步处理
- 内存优化和流式处理
- 性能监控和优化

## Migration Plan

### Phase 1: 基础设置界面
1. 实现移动端全屏设置页面
2. 创建桌面端对话框设置界面
3. 添加基础设置项和分组结构
4. 实现设置的加载和保存逻辑

### Phase 2: 开关设置功能
1. 实现同步通知开关
2. 添加深色模式切换功能
3. 实现设置的即时生效和持久化
4. 添加开关动画和状态反馈

### Phase 3: 数据管理功能
1. 实现 Loro 数据导出功能
2. 添加 Loro 数据导入功能
3. 创建导入导出确认对话框
4. 实现文件验证和错误处理

### Phase 4: 应用信息展示
1. 创建应用信息数据模型
2. 实现版本号和技术栈展示
3. 添加贡献者和更新日志
4. 实现外部链接（GitHub 等）

### Phase 5: Rust 端集成
1. 添加 Loro 数据导出 FFI 接口
2. 实现 Loro 数据导入 FFI 接口
3. 添加文件预览和解析功能
4. 实现数据合并逻辑

## Open Questions

1. **设置同步**: 如何处理多设备间的设置同步？
2. **备份策略**: 是否需要自动备份设置到云端？
3. **高级设置**: 是否需要预留高级设置扩展空间？
4. **设置验证**: 如何验证设置的有效性和安全性？
5. **主题定制**: 未来是否支持更多主题定制选项？